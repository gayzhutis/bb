<?php return array (
  'unique_key' => 'category',
  'preserve_keys' => false,
  'update_object' => true,
  'related_objects' => 
  array (
    'Chunks' => 
    array (
      '5256d86de44e83c57470c4ff3dc516cd' => 
      array (
        'preserve_keys' => false,
        'update_object' => false,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":0,"source":1,"property_preprocess":0,"name":"tpl.msProducts.discount.row","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"<div class=\\"row ms2_product\\">\\n\\t<div class=\\"span2 col-md-2\\"><img src=\\"[[+thumb:default=`[[++assets_url]]components\\/minishop2\\/img\\/web\\/ms2_small.png`]]\\" width=\\"120\\" height=\\"90\\" \\/><\\/div>\\n\\t<div class=\\"row span10 col-md-10\\">\\n\\t\\t<form method=\\"post\\" class=\\"ms2_form\\">\\n\\t\\t\\t<a href=\\"[[~[[+id]]]]\\">[[+pagetitle]]<\\/a>\\n\\t\\t\\t<span class=\\"flags\\">[[+new]] [[+popular]] [[+favorite]]<\\/span>\\n\\t\\t\\t<span class=\\"price\\">[[+price]] [[%ms2_frontend_currency]][[+remains]]<\\/span>\\n\\t\\t\\t[[+old_price]]\\n\\t\\t\\t<button class=\\"btn btn-default\\" type=\\"submit\\" name=\\"ms2_action\\" value=\\"cart\\/add\\"><i class=\\"glyphicon glyphicon-barcode\\"><\\/i> [[%ms2_frontend_add_to_cart]]<\\/button>\\n\\t\\t\\t<input type=\\"hidden\\" name=\\"id\\" value=\\"[[+id]]\\">\\n\\t\\t\\t<input type=\\"hidden\\" name=\\"count\\" value=\\"1\\">\\n\\t\\t\\t<input type=\\"hidden\\" name=\\"options\\" value=\\"[]\\">\\n\\t\\t<\\/form>\\n\\t\\t<p><small>[[+introtext]]<\\/small><\\/p>\\n\\t<\\/div>\\n<\\/div>\\n<br\\/><br\\/>\\n<!--minishop2_popular <i class=\\"glyphicon glyphicon-star\\" title=\\"[[%ms2_frontend_popular]]\\"><\\/i>-->\\n<!--minishop2_new <i class=\\"glyphicon glyphicon-flag\\" title=\\"[[%ms2_frontend_new]]\\"><\\/i>-->\\n<!--minishop2_favorite <i class=\\"glyphicon glyphicon-bookmark\\" title=\\"[[%ms2_frontend_favorite]]\\"><\\/i>-->\\n<!--minishop2_old_price <span class=\\"old_price\\">[[+old_price]] [[%ms2_frontend_currency]]<\\/span>-->\\n<!--minishop2_remains  (-[[+sale_discount]] \\u2014 <span class=\\"msd_remains\\">[[+remains]]<\\/span>)-->\\n<!--minishop2_!remains  (-[[+sale_discount]])-->","locked":0,"properties":null,"static":0,"static_file":"core\\/components\\/msdiscount\\/elements\\/chunks\\/chunk.msd_product_row.tpl","content":"<div class=\\"row ms2_product\\">\\n\\t<div class=\\"span2 col-md-2\\"><img src=\\"[[+thumb:default=`[[++assets_url]]components\\/minishop2\\/img\\/web\\/ms2_small.png`]]\\" width=\\"120\\" height=\\"90\\" \\/><\\/div>\\n\\t<div class=\\"row span10 col-md-10\\">\\n\\t\\t<form method=\\"post\\" class=\\"ms2_form\\">\\n\\t\\t\\t<a href=\\"[[~[[+id]]]]\\">[[+pagetitle]]<\\/a>\\n\\t\\t\\t<span class=\\"flags\\">[[+new]] [[+popular]] [[+favorite]]<\\/span>\\n\\t\\t\\t<span class=\\"price\\">[[+price]] [[%ms2_frontend_currency]][[+remains]]<\\/span>\\n\\t\\t\\t[[+old_price]]\\n\\t\\t\\t<button class=\\"btn btn-default\\" type=\\"submit\\" name=\\"ms2_action\\" value=\\"cart\\/add\\"><i class=\\"glyphicon glyphicon-barcode\\"><\\/i> [[%ms2_frontend_add_to_cart]]<\\/button>\\n\\t\\t\\t<input type=\\"hidden\\" name=\\"id\\" value=\\"[[+id]]\\">\\n\\t\\t\\t<input type=\\"hidden\\" name=\\"count\\" value=\\"1\\">\\n\\t\\t\\t<input type=\\"hidden\\" name=\\"options\\" value=\\"[]\\">\\n\\t\\t<\\/form>\\n\\t\\t<p><small>[[+introtext]]<\\/small><\\/p>\\n\\t<\\/div>\\n<\\/div>\\n<br\\/><br\\/>\\n<!--minishop2_popular <i class=\\"glyphicon glyphicon-star\\" title=\\"[[%ms2_frontend_popular]]\\"><\\/i>-->\\n<!--minishop2_new <i class=\\"glyphicon glyphicon-flag\\" title=\\"[[%ms2_frontend_new]]\\"><\\/i>-->\\n<!--minishop2_favorite <i class=\\"glyphicon glyphicon-bookmark\\" title=\\"[[%ms2_frontend_favorite]]\\"><\\/i>-->\\n<!--minishop2_old_price <span class=\\"old_price\\">[[+old_price]] [[%ms2_frontend_currency]]<\\/span>-->\\n<!--minishop2_remains  (-[[+sale_discount]] \\u2014 <span class=\\"msd_remains\\">[[+remains]]<\\/span>)-->\\n<!--minishop2_!remains  (-[[+sale_discount]])-->"}',
        'guid' => '812589ba597cbfc70eece8f73f7f8d0b',
        'native_key' => 0,
        'signature' => '5d45808a0861f75b11bd0240f6ddb197',
      ),
      'a9a6b44c1633c5a300740c0bed8d6448' => 
      array (
        'preserve_keys' => false,
        'update_object' => false,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":0,"source":1,"property_preprocess":0,"name":"tpl.msProduct.discount","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"[[+remains]]\\n<!--minishop2_remains -[[+sale_discount]] \\u2014 <span class=\\"msd_remains\\">[[+remains]]<\\/span>-->\\n<!--minishop2_!remains -[[+sale_discount]]-->","locked":0,"properties":null,"static":0,"static_file":"core\\/components\\/msdiscount\\/elements\\/chunks\\/chunk.msd_discount.tpl","content":"[[+remains]]\\n<!--minishop2_remains -[[+sale_discount]] \\u2014 <span class=\\"msd_remains\\">[[+remains]]<\\/span>-->\\n<!--minishop2_!remains -[[+sale_discount]]-->"}',
        'guid' => 'd262bd683a74039291936aadb75cc2ca',
        'native_key' => 0,
        'signature' => '8ee6400703db6a7f224a8c34e8106a35',
      ),
    ),
    'Snippets' => 
    array (
      '76fd5cd06985ef5162e656fc3ca8bd63' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":0,"source":1,"property_preprocess":0,"name":"msdBuyNow","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/** @var array $scriptProperties *\\/\\n\\/** @var pdoTools $pdoTools *\\/\\n$pdoTools = $modx->getService(\'pdoTools\');\\n\\/** @var msDiscount $msDiscount *\\/\\n$msDiscount = $modx->getService(\'msDiscount\');\\nif (!empty($frontend_css)) {\\n\\t$frontend_css = str_replace(\'[[+assetsUrl]]\', $msDiscount->config[\'assetsUrl\'], $frontend_css);\\n\\t$modx->regClientCSS($frontend_css);\\n}\\nif (!empty($frontend_js)) {\\n\\t$frontend_js = str_replace(\'[[+assetsUrl]]\', $msDiscount->config[\'assetsUrl\'], $frontend_js);\\n\\t$modx->regClientScript($frontend_js);\\n}\\n\\n$date = date(\'Y-m-d H:i:s\');\\n$pdoTools->setStore(\'msd_date\', $date);\\n$usergroups = array_keys($msDiscount->getUserGroups($modx->user->id));\\n$sales = $msDiscount->getSales($date, true);\\nif (!empty($sale)) {\\n\\t$pdoTools->setStore(\'msd_sale\', $sale);\\n\\t$tmp = array_map(\'trim\', explode(\',\', $sale));\\n\\tforeach ($sales as $id => $sale) {\\n\\t\\tif (!in_array($id, $tmp)) {\\n\\t\\t\\tunset($sales[$id]);\\n\\t\\t}\\n\\t}\\n}\\nif (empty($sales)) {\\n\\treturn !empty($showLog) && $modx->user->hasSessionContext(\'mgr\')\\n\\t\\t? $modx->lexicon(\'msd_err_no_sales\')\\n\\t\\t: \'\';\\n}\\n$all = false;\\n$parents_in = array();\\n$parents_out = array();\\nforeach ($sales as $idx => $sale) {\\n\\t\\/\\/ Check user groups\\n\\tif (!empty($sale[\'users\'])) {\\n\\t\\t$required = array();\\n\\t\\tforeach ($sale[\'users\'] as $gid => $type) {\\n\\t\\t\\tif ($type == \'out\' && in_array($gid, $usergroups)) {\\n\\t\\t\\t\\tunset($sales[$idx]);\\n\\t\\t\\t\\tcontinue(2);\\n\\t\\t\\t}\\n\\t\\t\\tif ($type == \'in\') {\\n\\t\\t\\t\\t$required[] = $gid;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tif (!empty($required) && !array_intersect($required, $usergroups)) {\\n\\t\\t\\tunset($sales[$idx]);\\n\\t\\t\\tcontinue;\\n\\t\\t}\\n\\t}\\n\\t\\/\\/ Check product groups\\n\\tif (!empty($sale[\'products\'])) {\\n\\t\\tforeach ($sale[\'products\'] as $gid => $type) {\\n\\t\\t\\t$c = $modx->newQuery(\'modResourceGroupResource\', array(\'document_group\' => $gid));\\n\\t\\t\\t$c->select(\'document\');\\n\\t\\t\\t$tstart = microtime(true);\\n\\t\\t\\tif ($c->prepare() && $c->stmt->execute()) {\\n\\t\\t\\t\\t$modx->queryTime += microtime(true) - $tstart;\\n\\t\\t\\t\\t$modx->executedQueries++;\\n\\t\\t\\t\\tif ($ids = $c->stmt->fetchAll(PDO::FETCH_COLUMN)) {\\n\\t\\t\\t\\t\\tif ($type == \'in\') {\\n\\t\\t\\t\\t\\t\\t$parents_in = array_merge($parents_in, $ids);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\telse {\\n\\t\\t\\t\\t\\t\\t$parents_out = array_merge($parents_out, $ids);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n\\t\\/\\/ All products\\n\\telse {\\n\\t\\t$all = true;\\n\\t\\tbreak;\\n\\t}\\n}\\n\\nif (!$parents_in && !$parents_out && !$all) {\\n\\treturn !empty($showLog) && $modx->user->hasSessionContext(\'mgr\')\\n\\t\\t? $modx->lexicon(\'msd_err_no_sales\')\\n\\t\\t: \'\';\\n}\\n\\nif (empty($scriptProperties[\'prepareSnippet\'])) {\\n\\t$scriptProperties[\'prepareSnippet\'] = \'msdGetDiscount\';\\n}\\n\\n$scriptProperties[\'parents\'] = 0;\\nif (!empty($scriptProperties[\'where\'])) {\\n\\t$where = !is_array($scriptProperties[\'where\'])\\n\\t\\t? $modx->fromJSON($scriptProperties[\'where\'])\\n\\t\\t: $scriptProperties[\'where\'];\\n}\\nelse {\\n\\t$where = array();\\n}\\nif (!$all) {\\n\\t$depth = (isset($config[\'depth\']) && $config[\'depth\'] !== \'\')\\n\\t\\t? (integer)$config[\'depth\']\\n\\t\\t: 10;\\n\\tif (!empty($depth) && $depth > 0) {\\n\\t\\t$pids = array();\\n\\t\\t$q = $modx->newQuery(\'modResource\', array(\'id:IN\' => array_merge($parents_in, $parents_out)));\\n\\t\\t$q->select(\'id,context_key\');\\n\\t\\t$tstart = microtime(true);\\n\\t\\tif ($q->prepare() && $q->stmt->execute()) {\\n\\t\\t\\t$modx->queryTime += microtime(true) - $tstart;\\n\\t\\t\\t$modx->executedQueries++;\\n\\t\\t\\twhile ($row = $q->stmt->fetch(PDO::FETCH_ASSOC)) {\\n\\t\\t\\t\\t$pids[$row[\'id\']] = $row[\'context_key\'];\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tforeach ($pids as $k => $v) {\\n\\t\\t\\tif (!is_numeric($k)) {\\n\\t\\t\\t\\tcontinue;\\n\\t\\t\\t}\\n\\t\\t\\telseif (in_array($k, $parents_in)) {\\n\\t\\t\\t\\t$parents_in = array_merge($parents_in, $modx->getChildIds($k, $depth, array(\'context\' => $v)));\\n\\t\\t\\t}\\n\\t\\t\\telse {\\n\\t\\t\\t\\t$parents_out = array_merge($parents_out, $modx->getChildIds($k, $depth, array(\'context\' => $v)));\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tif (empty($parents_in)) {\\n\\t\\t\\t$parents_in = $modx->getChildIds(0, $depth, array(\'context\' => $this->config[\'context\']));\\n\\t\\t}\\n\\t\\t\\/\\/ Support of miniShop2 categories\\n\\t\\t$members = array();\\n\\t\\tif (!empty($parents_in) || !empty($parents_out)) {\\n\\t\\t\\t$q = $modx->newQuery(\'msCategoryMember\');\\n\\t\\t\\tif (!empty($parents_in)) {\\n\\t\\t\\t\\t$q->where(array(\'category_id:IN\' => $parents_in));\\n\\t\\t\\t}\\n\\t\\t\\tif (!empty($parents_out)) {\\n\\t\\t\\t\\t$q->where(array(\'category_id:NOT IN\' => $parents_out));\\n\\t\\t\\t}\\n\\t\\t\\t$q->select(\'product_id\');\\n\\t\\t\\t$tstart = microtime(true);\\n\\t\\t\\tif ($q->prepare() && $q->stmt->execute()) {\\n\\t\\t\\t\\t$modx->queryTime += microtime(true) - $tstart;\\n\\t\\t\\t\\t$modx->executedQueries++;\\n\\t\\t\\t\\t$members = $q->stmt->fetchAll(PDO::FETCH_COLUMN);\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\t\\/\\/ Add parent to conditions\\n\\t\\tif (!empty($parents_in) && !empty($members)) {\\n\\t\\t\\t$members = array_merge($members, $parents_in);\\n\\t\\t\\t$where[] = array(\\n\\t\\t\\t\\t\'parent:IN\' => $parents_in,\\n\\t\\t\\t\\t\'OR:id:IN\' => $members,\\n\\t\\t\\t);\\n\\t\\t}\\n\\t\\telseif (!empty($parents_in)) {\\n\\t\\t\\t$where[] = array(\\n\\t\\t\\t\\t\'parent:IN\' => $parents_in,\\n\\t\\t\\t\\t\'OR:id:IN\' => $parents_in,\\n\\t\\t\\t);\\n\\t\\t}\\n\\t\\tif (!empty($parents_out)) {\\n\\t\\t\\t$where[] = array(\\n\\t\\t\\t\\t\'parent:NOT IN\' => $parents_out,\\n\\t\\t\\t\\t\'AND:id:NOT IN\' => $parents_out,\\n\\t\\t\\t);\\n\\t\\t}\\n\\t}\\n}\\n$scriptProperties[\'where\'] = $modx->toJSON($where);\\n\\nreturn $modx->runSnippet(\'msProducts\', $scriptProperties);","locked":0,"properties":"a:4:{s:4:\\"sale\\";a:7:{s:4:\\"name\\";s:4:\\"sale\\";s:4:\\"desc\\";s:20:\\"msdiscount_prop_sale\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:3:\\"tpl\\";a:7:{s:4:\\"name\\";s:3:\\"tpl\\";s:4:\\"desc\\";s:19:\\"msdiscount_prop_tpl\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:27:\\"tpl.msProducts.discount.row\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:12:\\"frontend_css\\";a:7:{s:4:\\"name\\";s:12:\\"frontend_css\\";s:4:\\"desc\\";s:28:\\"msdiscount_prop_frontend_css\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:30:\\"[[+assetsUrl]]css\\/web\\/main.css\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:11:\\"frontend_js\\";a:7:{s:4:\\"name\\";s:11:\\"frontend_js\\";s:4:\\"desc\\";s:27:\\"msdiscount_prop_frontend_js\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:31:\\"[[+assetsUrl]]js\\/web\\/default.js\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}}","moduleguid":"","static":0,"static_file":"core\\/components\\/msdiscount\\/elements\\/snippets\\/snippet.msdbuynow.php","content":"\\/** @var array $scriptProperties *\\/\\n\\/** @var pdoTools $pdoTools *\\/\\n$pdoTools = $modx->getService(\'pdoTools\');\\n\\/** @var msDiscount $msDiscount *\\/\\n$msDiscount = $modx->getService(\'msDiscount\');\\nif (!empty($frontend_css)) {\\n\\t$frontend_css = str_replace(\'[[+assetsUrl]]\', $msDiscount->config[\'assetsUrl\'], $frontend_css);\\n\\t$modx->regClientCSS($frontend_css);\\n}\\nif (!empty($frontend_js)) {\\n\\t$frontend_js = str_replace(\'[[+assetsUrl]]\', $msDiscount->config[\'assetsUrl\'], $frontend_js);\\n\\t$modx->regClientScript($frontend_js);\\n}\\n\\n$date = date(\'Y-m-d H:i:s\');\\n$pdoTools->setStore(\'msd_date\', $date);\\n$usergroups = array_keys($msDiscount->getUserGroups($modx->user->id));\\n$sales = $msDiscount->getSales($date, true);\\nif (!empty($sale)) {\\n\\t$pdoTools->setStore(\'msd_sale\', $sale);\\n\\t$tmp = array_map(\'trim\', explode(\',\', $sale));\\n\\tforeach ($sales as $id => $sale) {\\n\\t\\tif (!in_array($id, $tmp)) {\\n\\t\\t\\tunset($sales[$id]);\\n\\t\\t}\\n\\t}\\n}\\nif (empty($sales)) {\\n\\treturn !empty($showLog) && $modx->user->hasSessionContext(\'mgr\')\\n\\t\\t? $modx->lexicon(\'msd_err_no_sales\')\\n\\t\\t: \'\';\\n}\\n$all = false;\\n$parents_in = array();\\n$parents_out = array();\\nforeach ($sales as $idx => $sale) {\\n\\t\\/\\/ Check user groups\\n\\tif (!empty($sale[\'users\'])) {\\n\\t\\t$required = array();\\n\\t\\tforeach ($sale[\'users\'] as $gid => $type) {\\n\\t\\t\\tif ($type == \'out\' && in_array($gid, $usergroups)) {\\n\\t\\t\\t\\tunset($sales[$idx]);\\n\\t\\t\\t\\tcontinue(2);\\n\\t\\t\\t}\\n\\t\\t\\tif ($type == \'in\') {\\n\\t\\t\\t\\t$required[] = $gid;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tif (!empty($required) && !array_intersect($required, $usergroups)) {\\n\\t\\t\\tunset($sales[$idx]);\\n\\t\\t\\tcontinue;\\n\\t\\t}\\n\\t}\\n\\t\\/\\/ Check product groups\\n\\tif (!empty($sale[\'products\'])) {\\n\\t\\tforeach ($sale[\'products\'] as $gid => $type) {\\n\\t\\t\\t$c = $modx->newQuery(\'modResourceGroupResource\', array(\'document_group\' => $gid));\\n\\t\\t\\t$c->select(\'document\');\\n\\t\\t\\t$tstart = microtime(true);\\n\\t\\t\\tif ($c->prepare() && $c->stmt->execute()) {\\n\\t\\t\\t\\t$modx->queryTime += microtime(true) - $tstart;\\n\\t\\t\\t\\t$modx->executedQueries++;\\n\\t\\t\\t\\tif ($ids = $c->stmt->fetchAll(PDO::FETCH_COLUMN)) {\\n\\t\\t\\t\\t\\tif ($type == \'in\') {\\n\\t\\t\\t\\t\\t\\t$parents_in = array_merge($parents_in, $ids);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\telse {\\n\\t\\t\\t\\t\\t\\t$parents_out = array_merge($parents_out, $ids);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n\\t\\/\\/ All products\\n\\telse {\\n\\t\\t$all = true;\\n\\t\\tbreak;\\n\\t}\\n}\\n\\nif (!$parents_in && !$parents_out && !$all) {\\n\\treturn !empty($showLog) && $modx->user->hasSessionContext(\'mgr\')\\n\\t\\t? $modx->lexicon(\'msd_err_no_sales\')\\n\\t\\t: \'\';\\n}\\n\\nif (empty($scriptProperties[\'prepareSnippet\'])) {\\n\\t$scriptProperties[\'prepareSnippet\'] = \'msdGetDiscount\';\\n}\\n\\n$scriptProperties[\'parents\'] = 0;\\nif (!empty($scriptProperties[\'where\'])) {\\n\\t$where = !is_array($scriptProperties[\'where\'])\\n\\t\\t? $modx->fromJSON($scriptProperties[\'where\'])\\n\\t\\t: $scriptProperties[\'where\'];\\n}\\nelse {\\n\\t$where = array();\\n}\\nif (!$all) {\\n\\t$depth = (isset($config[\'depth\']) && $config[\'depth\'] !== \'\')\\n\\t\\t? (integer)$config[\'depth\']\\n\\t\\t: 10;\\n\\tif (!empty($depth) && $depth > 0) {\\n\\t\\t$pids = array();\\n\\t\\t$q = $modx->newQuery(\'modResource\', array(\'id:IN\' => array_merge($parents_in, $parents_out)));\\n\\t\\t$q->select(\'id,context_key\');\\n\\t\\t$tstart = microtime(true);\\n\\t\\tif ($q->prepare() && $q->stmt->execute()) {\\n\\t\\t\\t$modx->queryTime += microtime(true) - $tstart;\\n\\t\\t\\t$modx->executedQueries++;\\n\\t\\t\\twhile ($row = $q->stmt->fetch(PDO::FETCH_ASSOC)) {\\n\\t\\t\\t\\t$pids[$row[\'id\']] = $row[\'context_key\'];\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tforeach ($pids as $k => $v) {\\n\\t\\t\\tif (!is_numeric($k)) {\\n\\t\\t\\t\\tcontinue;\\n\\t\\t\\t}\\n\\t\\t\\telseif (in_array($k, $parents_in)) {\\n\\t\\t\\t\\t$parents_in = array_merge($parents_in, $modx->getChildIds($k, $depth, array(\'context\' => $v)));\\n\\t\\t\\t}\\n\\t\\t\\telse {\\n\\t\\t\\t\\t$parents_out = array_merge($parents_out, $modx->getChildIds($k, $depth, array(\'context\' => $v)));\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tif (empty($parents_in)) {\\n\\t\\t\\t$parents_in = $modx->getChildIds(0, $depth, array(\'context\' => $this->config[\'context\']));\\n\\t\\t}\\n\\t\\t\\/\\/ Support of miniShop2 categories\\n\\t\\t$members = array();\\n\\t\\tif (!empty($parents_in) || !empty($parents_out)) {\\n\\t\\t\\t$q = $modx->newQuery(\'msCategoryMember\');\\n\\t\\t\\tif (!empty($parents_in)) {\\n\\t\\t\\t\\t$q->where(array(\'category_id:IN\' => $parents_in));\\n\\t\\t\\t}\\n\\t\\t\\tif (!empty($parents_out)) {\\n\\t\\t\\t\\t$q->where(array(\'category_id:NOT IN\' => $parents_out));\\n\\t\\t\\t}\\n\\t\\t\\t$q->select(\'product_id\');\\n\\t\\t\\t$tstart = microtime(true);\\n\\t\\t\\tif ($q->prepare() && $q->stmt->execute()) {\\n\\t\\t\\t\\t$modx->queryTime += microtime(true) - $tstart;\\n\\t\\t\\t\\t$modx->executedQueries++;\\n\\t\\t\\t\\t$members = $q->stmt->fetchAll(PDO::FETCH_COLUMN);\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\t\\/\\/ Add parent to conditions\\n\\t\\tif (!empty($parents_in) && !empty($members)) {\\n\\t\\t\\t$members = array_merge($members, $parents_in);\\n\\t\\t\\t$where[] = array(\\n\\t\\t\\t\\t\'parent:IN\' => $parents_in,\\n\\t\\t\\t\\t\'OR:id:IN\' => $members,\\n\\t\\t\\t);\\n\\t\\t}\\n\\t\\telseif (!empty($parents_in)) {\\n\\t\\t\\t$where[] = array(\\n\\t\\t\\t\\t\'parent:IN\' => $parents_in,\\n\\t\\t\\t\\t\'OR:id:IN\' => $parents_in,\\n\\t\\t\\t);\\n\\t\\t}\\n\\t\\tif (!empty($parents_out)) {\\n\\t\\t\\t$where[] = array(\\n\\t\\t\\t\\t\'parent:NOT IN\' => $parents_out,\\n\\t\\t\\t\\t\'AND:id:NOT IN\' => $parents_out,\\n\\t\\t\\t);\\n\\t\\t}\\n\\t}\\n}\\n$scriptProperties[\'where\'] = $modx->toJSON($where);\\n\\nreturn $modx->runSnippet(\'msProducts\', $scriptProperties);"}',
        'guid' => '665f353c664a5de0cc23d96e838e339c',
        'native_key' => 0,
        'signature' => '8e881570931d0ff185b359facc514a40',
      ),
      'bf3abbfd2a5049b4feed4eea0e73b7d3' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":0,"source":1,"property_preprocess":0,"name":"msdGetDiscount","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/** @var msDiscount $msDiscount *\\/\\n\\/** @var pdoTools $pdoTools *\\/\\n$pdoTools = $modx->getService(\'pdoTools\');\\n$msDiscount = $modx->getService(\'msDiscount\');\\n$date = $pdoTools->getStore(\'msd_date\');\\n$usergroups = array_keys($msDiscount->getUserGroups($modx->user->id));\\n$sales = !empty($date)\\n\\t? $msDiscount->getSales($date, true)\\n\\t: $msDiscount->getSales();\\nif (empty($sale)) {\\n\\t$sale = $pdoTools->getStore(\'msd_sale\');\\n}\\nif (!empty($sale)) {\\n\\t$tmp = array_map(\'trim\', explode(\',\', $sale));\\n\\tforeach ($sales as $id => $sale) {\\n\\t\\tif (!in_array($id, $tmp)) {\\n\\t\\t\\tunset($sales[$id]);\\n\\t\\t}\\n\\t}\\n}\\nif (!empty($row) && is_array($row)) {\\n\\t$mode = \'prepare\';\\n\\tif (!empty($row[\'id\'])) {\\n\\t\\t$id = $row[\'id\'];\\n\\t}\\n}\\nelse {\\n\\t$mode = \'standalone\';\\n\\tif (!empty($frontend_css)) {\\n\\t\\t$frontend_css = str_replace(\'[[+assetsUrl]]\', $msDiscount->config[\'assetsUrl\'], $frontend_css);\\n\\t\\t$modx->regClientCSS($frontend_css);\\n\\t}\\n\\tif (!empty($frontend_js)) {\\n\\t\\t$frontend_js = str_replace(\'[[+assetsUrl]]\', $msDiscount->config[\'assetsUrl\'], $frontend_js);\\n\\t\\t$modx->regClientScript($frontend_js);\\n\\t}\\n\\tif (empty($id)) {\\n\\t\\t$id = $modx->resource->id;\\n\\t}\\n}\\n\\n$remains = $discount = 0;\\nif (!empty($id) && !empty($sales)) {\\n\\tforeach ($sales as $sale) {\\n\\t\\t\\/\\/ Check user groups\\n\\t\\tif (!empty($sale[\'users\'])) {\\n\\t\\t\\t$required = array();\\n\\t\\t\\tforeach ($sale[\'users\'] as $gid => $type) {\\n\\t\\t\\t\\tif ($type == \'out\' && in_array($gid, $usergroups)) {\\n\\t\\t\\t\\t\\tunset($sales[$idx]);\\n\\t\\t\\t\\t\\tcontinue(2);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tif ($type == \'in\') {\\n\\t\\t\\t\\t\\t$required[] = $gid;\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\\tif (!empty($required) && !array_intersect($required, $usergroups)) {\\n\\t\\t\\t\\tunset($sales[$idx]);\\n\\t\\t\\t\\tcontinue;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\t\\/\\/ Check product groups\\n\\t\\tif (!empty($sale[\'products\'])) {\\n\\t\\t\\t$groups_in = $groups_out = array();\\n\\t\\t\\tforeach ($sale[\'products\'] as $gid => $type) {\\n\\t\\t\\t\\tif ($type == \'out\') {\\n\\t\\t\\t\\t\\t$groups_out[] = $gid;\\n\\t\\t\\t\\t\\tunset($sale[\'products\'][$gid]);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\telse {\\n\\t\\t\\t\\t\\t$groups_in[] = $gid;\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\n\\t\\tif (!empty($groups_out) || !empty($groups_in)) {\\n\\t\\t\\t$ids = $modx->getParentIds($id);\\n\\t\\t\\t$ids[] = $id;\\n\\n\\t\\t\\t$q = $modx->newQuery(\'msCategoryMember\', array(\'product_id\' => $id));\\n\\t\\t\\t$q->select(\'category_id\');\\n\\t\\t\\t$tstart = microtime(true);\\n\\t\\t\\tif ($q->prepare() && $q->stmt->execute()) {\\n\\t\\t\\t\\t$modx->queryTime += microtime(true) - $tstart;\\n\\t\\t\\t\\t$modx->executedQueries++;\\n\\t\\t\\t\\tif ($tmp = $q->stmt->fetchAll(PDO::FETCH_COLUMN)) {\\n\\t\\t\\t\\t\\t$ids = array_merge($ids, $tmp);\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\\t$ids = array_unique($ids);\\n\\t\\t\\t$where = count($ids) > 1\\n\\t\\t\\t\\t? array(\'document:IN\' => $ids)\\n\\t\\t\\t\\t: array(\'document\' => $ids[0]);\\n\\n\\t\\t\\t$q = $modx->newQuery(\'modResourceGroupResource\', $where);\\n\\t\\t\\t$q->select(\'document_group\');\\n\\t\\t\\t$tstart = microtime(true);\\n\\t\\t\\tif ($q->prepare() && $q->stmt->execute()) {\\n\\t\\t\\t\\t$modx->queryTime += microtime(true) - $tstart;\\n\\t\\t\\t\\t$modx->executedQueries++;\\n\\t\\t\\t\\t$groups = $q->stmt->fetchAll(PDO::FETCH_COLUMN);\\n\\t\\t\\t\\tif (!empty($groups_out) && array_intersect($groups_out, $groups)) {\\n\\t\\t\\t\\t\\tcontinue;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\telseif (!empty($groups_in) && !array_intersect($groups_in, $groups)) {\\n\\t\\t\\t\\t\\tcontinue;\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\n\\t\\t\\/\\/ Product match\\n\\t\\t$tmp_remains = ($sale[\'ends\'] != \'0000-00-00 00:00:00\')\\n\\t\\t\\t? strtotime($sale[\'ends\']) - time()\\n\\t\\t\\t: 0;\\n\\t\\tif (strpos($sale[\'discount\'], \'%\') !== false && (empty($discount) || strpos($discount, \'%\') !== false)) {\\n\\t\\t\\tif ($sale[\'discount\'] > $discount) {\\n\\t\\t\\t\\t$discount = $sale[\'discount\'];\\n\\t\\t\\t\\t$remains = $tmp_remains;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\telseif (is_numeric($sale[\'discount\']) && is_numeric($discount)) {\\n\\t\\t\\tif ($sale[\'discount\'] > $discount) {\\n\\t\\t\\t\\t$discount = $sale[\'discount\'];\\n\\t\\t\\t\\t$remains = $tmp_remains;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\telse {\\n\\t\\t\\t$discount = $sale[\'discount\'];\\n\\t\\t\\t$remains = $tmp_remains;\\n\\t\\t}\\n\\t}\\n}\\n\\n$arr = array(\\n\\t\'sale_discount\' => $discount,\\n\\t\'remains\' => $remains,\\n);\\nif ($mode == \'standalone\') {\\n\\t$pdoTools->config[\'nestedChunkPrefix\'] = \'minishop2_\';\\n\\n\\treturn !empty($tpl)\\n\\t\\t? $pdoTools->getChunk($tpl, $arr)\\n\\t\\t: print_r($arr, true);\\n}\\nelse {\\n\\t$row = array_merge($row, $arr);\\n\\n\\treturn $modx->toJSON($row);\\n}","locked":0,"properties":"a:5:{s:2:\\"id\\";a:7:{s:4:\\"name\\";s:2:\\"id\\";s:4:\\"desc\\";s:18:\\"msdiscount_prop_id\\";s:4:\\"type\\";s:11:\\"numberfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:4:\\"sale\\";a:7:{s:4:\\"name\\";s:4:\\"sale\\";s:4:\\"desc\\";s:20:\\"msdiscount_prop_sale\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:3:\\"tpl\\";a:7:{s:4:\\"name\\";s:3:\\"tpl\\";s:4:\\"desc\\";s:19:\\"msdiscount_prop_tpl\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:22:\\"tpl.msProduct.discount\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:12:\\"frontend_css\\";a:7:{s:4:\\"name\\";s:12:\\"frontend_css\\";s:4:\\"desc\\";s:28:\\"msdiscount_prop_frontend_css\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:30:\\"[[+assetsUrl]]css\\/web\\/main.css\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:11:\\"frontend_js\\";a:7:{s:4:\\"name\\";s:11:\\"frontend_js\\";s:4:\\"desc\\";s:27:\\"msdiscount_prop_frontend_js\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:31:\\"[[+assetsUrl]]js\\/web\\/default.js\\";s:7:\\"lexicon\\";s:21:\\"msdiscount:properties\\";s:4:\\"area\\";s:0:\\"\\";}}","moduleguid":"","static":0,"static_file":"core\\/components\\/msdiscount\\/elements\\/snippets\\/snippet.msdgetdiscount.php","content":"\\/** @var msDiscount $msDiscount *\\/\\n\\/** @var pdoTools $pdoTools *\\/\\n$pdoTools = $modx->getService(\'pdoTools\');\\n$msDiscount = $modx->getService(\'msDiscount\');\\n$date = $pdoTools->getStore(\'msd_date\');\\n$usergroups = array_keys($msDiscount->getUserGroups($modx->user->id));\\n$sales = !empty($date)\\n\\t? $msDiscount->getSales($date, true)\\n\\t: $msDiscount->getSales();\\nif (empty($sale)) {\\n\\t$sale = $pdoTools->getStore(\'msd_sale\');\\n}\\nif (!empty($sale)) {\\n\\t$tmp = array_map(\'trim\', explode(\',\', $sale));\\n\\tforeach ($sales as $id => $sale) {\\n\\t\\tif (!in_array($id, $tmp)) {\\n\\t\\t\\tunset($sales[$id]);\\n\\t\\t}\\n\\t}\\n}\\nif (!empty($row) && is_array($row)) {\\n\\t$mode = \'prepare\';\\n\\tif (!empty($row[\'id\'])) {\\n\\t\\t$id = $row[\'id\'];\\n\\t}\\n}\\nelse {\\n\\t$mode = \'standalone\';\\n\\tif (!empty($frontend_css)) {\\n\\t\\t$frontend_css = str_replace(\'[[+assetsUrl]]\', $msDiscount->config[\'assetsUrl\'], $frontend_css);\\n\\t\\t$modx->regClientCSS($frontend_css);\\n\\t}\\n\\tif (!empty($frontend_js)) {\\n\\t\\t$frontend_js = str_replace(\'[[+assetsUrl]]\', $msDiscount->config[\'assetsUrl\'], $frontend_js);\\n\\t\\t$modx->regClientScript($frontend_js);\\n\\t}\\n\\tif (empty($id)) {\\n\\t\\t$id = $modx->resource->id;\\n\\t}\\n}\\n\\n$remains = $discount = 0;\\nif (!empty($id) && !empty($sales)) {\\n\\tforeach ($sales as $sale) {\\n\\t\\t\\/\\/ Check user groups\\n\\t\\tif (!empty($sale[\'users\'])) {\\n\\t\\t\\t$required = array();\\n\\t\\t\\tforeach ($sale[\'users\'] as $gid => $type) {\\n\\t\\t\\t\\tif ($type == \'out\' && in_array($gid, $usergroups)) {\\n\\t\\t\\t\\t\\tunset($sales[$idx]);\\n\\t\\t\\t\\t\\tcontinue(2);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tif ($type == \'in\') {\\n\\t\\t\\t\\t\\t$required[] = $gid;\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\\tif (!empty($required) && !array_intersect($required, $usergroups)) {\\n\\t\\t\\t\\tunset($sales[$idx]);\\n\\t\\t\\t\\tcontinue;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\t\\/\\/ Check product groups\\n\\t\\tif (!empty($sale[\'products\'])) {\\n\\t\\t\\t$groups_in = $groups_out = array();\\n\\t\\t\\tforeach ($sale[\'products\'] as $gid => $type) {\\n\\t\\t\\t\\tif ($type == \'out\') {\\n\\t\\t\\t\\t\\t$groups_out[] = $gid;\\n\\t\\t\\t\\t\\tunset($sale[\'products\'][$gid]);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\telse {\\n\\t\\t\\t\\t\\t$groups_in[] = $gid;\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\n\\t\\tif (!empty($groups_out) || !empty($groups_in)) {\\n\\t\\t\\t$ids = $modx->getParentIds($id);\\n\\t\\t\\t$ids[] = $id;\\n\\n\\t\\t\\t$q = $modx->newQuery(\'msCategoryMember\', array(\'product_id\' => $id));\\n\\t\\t\\t$q->select(\'category_id\');\\n\\t\\t\\t$tstart = microtime(true);\\n\\t\\t\\tif ($q->prepare() && $q->stmt->execute()) {\\n\\t\\t\\t\\t$modx->queryTime += microtime(true) - $tstart;\\n\\t\\t\\t\\t$modx->executedQueries++;\\n\\t\\t\\t\\tif ($tmp = $q->stmt->fetchAll(PDO::FETCH_COLUMN)) {\\n\\t\\t\\t\\t\\t$ids = array_merge($ids, $tmp);\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\\t$ids = array_unique($ids);\\n\\t\\t\\t$where = count($ids) > 1\\n\\t\\t\\t\\t? array(\'document:IN\' => $ids)\\n\\t\\t\\t\\t: array(\'document\' => $ids[0]);\\n\\n\\t\\t\\t$q = $modx->newQuery(\'modResourceGroupResource\', $where);\\n\\t\\t\\t$q->select(\'document_group\');\\n\\t\\t\\t$tstart = microtime(true);\\n\\t\\t\\tif ($q->prepare() && $q->stmt->execute()) {\\n\\t\\t\\t\\t$modx->queryTime += microtime(true) - $tstart;\\n\\t\\t\\t\\t$modx->executedQueries++;\\n\\t\\t\\t\\t$groups = $q->stmt->fetchAll(PDO::FETCH_COLUMN);\\n\\t\\t\\t\\tif (!empty($groups_out) && array_intersect($groups_out, $groups)) {\\n\\t\\t\\t\\t\\tcontinue;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\telseif (!empty($groups_in) && !array_intersect($groups_in, $groups)) {\\n\\t\\t\\t\\t\\tcontinue;\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\n\\t\\t\\/\\/ Product match\\n\\t\\t$tmp_remains = ($sale[\'ends\'] != \'0000-00-00 00:00:00\')\\n\\t\\t\\t? strtotime($sale[\'ends\']) - time()\\n\\t\\t\\t: 0;\\n\\t\\tif (strpos($sale[\'discount\'], \'%\') !== false && (empty($discount) || strpos($discount, \'%\') !== false)) {\\n\\t\\t\\tif ($sale[\'discount\'] > $discount) {\\n\\t\\t\\t\\t$discount = $sale[\'discount\'];\\n\\t\\t\\t\\t$remains = $tmp_remains;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\telseif (is_numeric($sale[\'discount\']) && is_numeric($discount)) {\\n\\t\\t\\tif ($sale[\'discount\'] > $discount) {\\n\\t\\t\\t\\t$discount = $sale[\'discount\'];\\n\\t\\t\\t\\t$remains = $tmp_remains;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\telse {\\n\\t\\t\\t$discount = $sale[\'discount\'];\\n\\t\\t\\t$remains = $tmp_remains;\\n\\t\\t}\\n\\t}\\n}\\n\\n$arr = array(\\n\\t\'sale_discount\' => $discount,\\n\\t\'remains\' => $remains,\\n);\\nif ($mode == \'standalone\') {\\n\\t$pdoTools->config[\'nestedChunkPrefix\'] = \'minishop2_\';\\n\\n\\treturn !empty($tpl)\\n\\t\\t? $pdoTools->getChunk($tpl, $arr)\\n\\t\\t: print_r($arr, true);\\n}\\nelse {\\n\\t$row = array_merge($row, $arr);\\n\\n\\treturn $modx->toJSON($row);\\n}"}',
        'guid' => '9f2a94b1d7c127c5cb9876e2ecdc533f',
        'native_key' => 0,
        'signature' => '331d26da616176d450ce8918fa62b1bc',
      ),
    ),
    'Plugins' => 
    array (
      '080d3210eb4db93d8620349a8e5ff683' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modPlugin',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"msDiscount","description":"","editor_type":0,"category":0,"cache_type":0,"plugincode":"\\/** @var msDiscount $msDiscount *\\/\\n$msDiscount = $modx->getService(\'msDiscount\');\\n\\nswitch ($modx->event->name) {\\n\\n\\tcase \'msOnGetProductPrice\':\\n\\t\\tif ($modx->context->key == \'mgr\') {return;}\\n\\t\\t\\/**\\n\\t\\t * Counts discount of current product for current user, based on rules in msDiscount component\\n\\t\\t * New price must be set in $modx->event->returnedValues[\'price\']\\n\\t\\t *\\n\\t\\t * @var msProductData $product Object with product properties\\n\\t\\t * @var array $data Array with product properties. Can be empty!\\n\\t\\t * @var float $price Current price of product\\n\\t\\t *\\/\\n\\t\\tif (!isset($modx->event->returnedValues[\'price\'])) {\\n\\t\\t\\t$modx->event->returnedValues[\'price\'] = $price;\\n\\t\\t}\\n\\t\\t\\/\\/ Get link to product price\\n\\t\\t$price = & $modx->event->returnedValues[\'price\'];\\n\\t\\t$new_price = $msDiscount->getNewPrice($product->id, $price);\\n\\t\\tif ($new_price !== false) {\\n\\t\\t\\t$price = $new_price;\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'msOnChangeOrderStatus\':\\n\\t\\t\\/**\\n\\t\\t * Add user to discounts group if he spent required sum for join\\n\\t\\t *\\n\\t\\t * @var msOrder $order\\n\\t\\t * @var integer $status\\n\\t\\t *\\/\\n\\t\\tif ($status != 2) {return;}\\n\\n\\t\\t\\/** @var modUser $user *\\/\\n\\t\\tif ($user = $order->getOne(\'User\')) {\\n\\t\\t\\tif ($profile = $modx->getObject(\'msCustomerProfile\', $user->id)) {\\n\\t\\t\\t\\t$spent = $profile->spent;\\n\\t\\t\\t\\tif ($spent > 0) {\\n\\t\\t\\t\\t\\t$q = $modx->newQuery(\'msdUserGroup\');\\n\\t\\t\\t\\t\\t$q->where(\'joinsum > 0\');\\n\\t\\t\\t\\t\\t$q->select(\'id,joinsum\');\\n\\t\\t\\t\\t\\tif ($q->prepare() && $q->stmt->execute()) {\\n\\t\\t\\t\\t\\t\\t$groups = $msDiscount->getUserGroups($user->id);\\n\\t\\t\\t\\t\\t\\twhile ($row = $q->stmt->fetch(PDO::FETCH_ASSOC)) {\\n\\t\\t\\t\\t\\t\\t\\tif ($spent > $row[\'joinsum\'] && !isset($groups[$row[\'id\']])) {\\n\\t\\t\\t\\t\\t\\t\\t\\t$user->joinGroup((integer) $row[\'id\'], 1);\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'msOnBeforeAddToOrder\':\\n\\t\\t\\/** @var string $key *\\/\\n\\t\\tif ($key == \'coupon_code\' && !empty($value)) {\\n\\t\\t\\t$check = $msDiscount->checkCoupon($value);\\n\\t\\t\\tif ($check !== true) {\\n\\t\\t\\t\\t$modx->event->output($check);\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'msOnGetOrderCost\':\\n\\t\\t\\/**@var msOrderInterface $order *\\/\\n\\t\\tif (!empty($with_cart) && !empty($cost)) {\\n\\t\\t\\tif ($data = $order->get()) {\\n\\t\\t\\t\\tif (!empty($data[\'coupon_code\']) && $msDiscount->checkCoupon($data[\'coupon_code\']) === true) {\\n\\t\\t\\t\\t\\tif ($discount = $msDiscount->getCouponDiscount($data[\'coupon_code\'], $cost)) {\\n\\t\\t\\t\\t\\t\\t$cost -= $discount;\\n\\t\\t\\t\\t\\t\\tif ($cost >= 0) {\\n\\t\\t\\t\\t\\t\\t\\t$modx->event->returnedValues[\'cost\'] = $cost;\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'msOnCreateOrder\':\\n\\t\\t\\/**@var msOrderInterface $order *\\/\\n\\t\\tif ($data = $order->get()) {\\n\\t\\t\\t\\/**@var msdCoupon $coupon *\\/\\n\\t\\t\\tif (!empty($data[\'coupon_code\']) && $coupon = $modx->getObject(\'msdCoupon\', array(\'code\' => $data[\'coupon_code\']))) {\\n\\t\\t\\t\\t\\/**@var msOrder $msOrder *\\/\\n\\t\\t\\t\\t$coupon->fromArray(array(\\n\\t\\t\\t\\t\\t\'active\' => false,\\n\\t\\t\\t\\t\\t\'activatedon\' => date(\'Y-m-d H:i:s\'),\\n\\t\\t\\t\\t\\t\'order_id\' => $msOrder->get(\'id\'),\\n\\t\\t\\t\\t));\\n\\t\\t\\t\\t$coupon->save();\\n\\t\\t\\t\\t$properties = $msOrder->get(\'properties\');\\n\\t\\t\\t\\tif (!is_array($properties)) {\\n\\t\\t\\t\\t\\t$properties = array();\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\t$properties[\'coupon_code\'] = $coupon->get(\'code\');\\n\\t\\t\\t\\tif ($group = $coupon->getOne(\'Group\')) {\\n\\t\\t\\t\\t\\t$properties[\'coupon_discount\'] = $group->get(\'discount\');\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\t$msOrder->set(\'properties\', $properties);\\n\\t\\t\\t\\t$msOrder->save();\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'OnWebLogin\':\\n\\tcase \'OnWebLogout\':\\n\\t\\t\\/** Set flag for cart reload *\\/\\n\\t\\t$_SESSION[\'minishop2\'][\'cart_reload\'] = true;\\n\\t\\tbreak;\\n\\n\\tcase \'OnLoadWebDocument\':\\n\\t\\t\\/**\\n\\t\\t * Recalculate cart of user if flag is set\\n\\t\\t * @var miniShop2 $miniShop2\\n\\t\\t *\\/\\n\\t\\tif (empty($_SESSION[\'minishop2\'][\'cart_reload\'])) {return;}\\n\\n\\t\\t$miniShop2 = $modx->getService(\'miniShop2\');\\n\\t\\t$miniShop2->initialize($modx->context->key);\\n\\n\\t\\t$cart = $miniShop2->cart->get();\\n\\t\\tif (!empty($cart)) {\\n\\t\\t\\tforeach ($cart as $key => $item) {\\n\\t\\t\\t\\t\\/** @var msProduct $product *\\/\\n\\t\\t\\t\\tif ($product = $modx->getObject(\'msProductData\', $item[\'id\'])) {\\n\\t\\t\\t\\t\\t$cart[$key][\'price\'] = $product->getPrice();\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\\t$miniShop2->cart->set($cart);\\n\\t\\t}\\n\\t\\tunset($_SESSION[\'minishop2\'][\'cart_reload\']);\\n\\t\\tbreak;\\n}","locked":0,"properties":null,"disabled":0,"moduleguid":"","static":0,"static_file":"core\\/components\\/msdiscount\\/elements\\/plugins\\/plugin.msdiscount.php","content":"\\/** @var msDiscount $msDiscount *\\/\\n$msDiscount = $modx->getService(\'msDiscount\');\\n\\nswitch ($modx->event->name) {\\n\\n\\tcase \'msOnGetProductPrice\':\\n\\t\\tif ($modx->context->key == \'mgr\') {return;}\\n\\t\\t\\/**\\n\\t\\t * Counts discount of current product for current user, based on rules in msDiscount component\\n\\t\\t * New price must be set in $modx->event->returnedValues[\'price\']\\n\\t\\t *\\n\\t\\t * @var msProductData $product Object with product properties\\n\\t\\t * @var array $data Array with product properties. Can be empty!\\n\\t\\t * @var float $price Current price of product\\n\\t\\t *\\/\\n\\t\\tif (!isset($modx->event->returnedValues[\'price\'])) {\\n\\t\\t\\t$modx->event->returnedValues[\'price\'] = $price;\\n\\t\\t}\\n\\t\\t\\/\\/ Get link to product price\\n\\t\\t$price = & $modx->event->returnedValues[\'price\'];\\n\\t\\t$new_price = $msDiscount->getNewPrice($product->id, $price);\\n\\t\\tif ($new_price !== false) {\\n\\t\\t\\t$price = $new_price;\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'msOnChangeOrderStatus\':\\n\\t\\t\\/**\\n\\t\\t * Add user to discounts group if he spent required sum for join\\n\\t\\t *\\n\\t\\t * @var msOrder $order\\n\\t\\t * @var integer $status\\n\\t\\t *\\/\\n\\t\\tif ($status != 2) {return;}\\n\\n\\t\\t\\/** @var modUser $user *\\/\\n\\t\\tif ($user = $order->getOne(\'User\')) {\\n\\t\\t\\tif ($profile = $modx->getObject(\'msCustomerProfile\', $user->id)) {\\n\\t\\t\\t\\t$spent = $profile->spent;\\n\\t\\t\\t\\tif ($spent > 0) {\\n\\t\\t\\t\\t\\t$q = $modx->newQuery(\'msdUserGroup\');\\n\\t\\t\\t\\t\\t$q->where(\'joinsum > 0\');\\n\\t\\t\\t\\t\\t$q->select(\'id,joinsum\');\\n\\t\\t\\t\\t\\tif ($q->prepare() && $q->stmt->execute()) {\\n\\t\\t\\t\\t\\t\\t$groups = $msDiscount->getUserGroups($user->id);\\n\\t\\t\\t\\t\\t\\twhile ($row = $q->stmt->fetch(PDO::FETCH_ASSOC)) {\\n\\t\\t\\t\\t\\t\\t\\tif ($spent > $row[\'joinsum\'] && !isset($groups[$row[\'id\']])) {\\n\\t\\t\\t\\t\\t\\t\\t\\t$user->joinGroup((integer) $row[\'id\'], 1);\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'msOnBeforeAddToOrder\':\\n\\t\\t\\/** @var string $key *\\/\\n\\t\\tif ($key == \'coupon_code\' && !empty($value)) {\\n\\t\\t\\t$check = $msDiscount->checkCoupon($value);\\n\\t\\t\\tif ($check !== true) {\\n\\t\\t\\t\\t$modx->event->output($check);\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'msOnGetOrderCost\':\\n\\t\\t\\/**@var msOrderInterface $order *\\/\\n\\t\\tif (!empty($with_cart) && !empty($cost)) {\\n\\t\\t\\tif ($data = $order->get()) {\\n\\t\\t\\t\\tif (!empty($data[\'coupon_code\']) && $msDiscount->checkCoupon($data[\'coupon_code\']) === true) {\\n\\t\\t\\t\\t\\tif ($discount = $msDiscount->getCouponDiscount($data[\'coupon_code\'], $cost)) {\\n\\t\\t\\t\\t\\t\\t$cost -= $discount;\\n\\t\\t\\t\\t\\t\\tif ($cost >= 0) {\\n\\t\\t\\t\\t\\t\\t\\t$modx->event->returnedValues[\'cost\'] = $cost;\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'msOnCreateOrder\':\\n\\t\\t\\/**@var msOrderInterface $order *\\/\\n\\t\\tif ($data = $order->get()) {\\n\\t\\t\\t\\/**@var msdCoupon $coupon *\\/\\n\\t\\t\\tif (!empty($data[\'coupon_code\']) && $coupon = $modx->getObject(\'msdCoupon\', array(\'code\' => $data[\'coupon_code\']))) {\\n\\t\\t\\t\\t\\/**@var msOrder $msOrder *\\/\\n\\t\\t\\t\\t$coupon->fromArray(array(\\n\\t\\t\\t\\t\\t\'active\' => false,\\n\\t\\t\\t\\t\\t\'activatedon\' => date(\'Y-m-d H:i:s\'),\\n\\t\\t\\t\\t\\t\'order_id\' => $msOrder->get(\'id\'),\\n\\t\\t\\t\\t));\\n\\t\\t\\t\\t$coupon->save();\\n\\t\\t\\t\\t$properties = $msOrder->get(\'properties\');\\n\\t\\t\\t\\tif (!is_array($properties)) {\\n\\t\\t\\t\\t\\t$properties = array();\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\t$properties[\'coupon_code\'] = $coupon->get(\'code\');\\n\\t\\t\\t\\tif ($group = $coupon->getOne(\'Group\')) {\\n\\t\\t\\t\\t\\t$properties[\'coupon_discount\'] = $group->get(\'discount\');\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\t$msOrder->set(\'properties\', $properties);\\n\\t\\t\\t\\t$msOrder->save();\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tbreak;\\n\\n\\tcase \'OnWebLogin\':\\n\\tcase \'OnWebLogout\':\\n\\t\\t\\/** Set flag for cart reload *\\/\\n\\t\\t$_SESSION[\'minishop2\'][\'cart_reload\'] = true;\\n\\t\\tbreak;\\n\\n\\tcase \'OnLoadWebDocument\':\\n\\t\\t\\/**\\n\\t\\t * Recalculate cart of user if flag is set\\n\\t\\t * @var miniShop2 $miniShop2\\n\\t\\t *\\/\\n\\t\\tif (empty($_SESSION[\'minishop2\'][\'cart_reload\'])) {return;}\\n\\n\\t\\t$miniShop2 = $modx->getService(\'miniShop2\');\\n\\t\\t$miniShop2->initialize($modx->context->key);\\n\\n\\t\\t$cart = $miniShop2->cart->get();\\n\\t\\tif (!empty($cart)) {\\n\\t\\t\\tforeach ($cart as $key => $item) {\\n\\t\\t\\t\\t\\/** @var msProduct $product *\\/\\n\\t\\t\\t\\tif ($product = $modx->getObject(\'msProductData\', $item[\'id\'])) {\\n\\t\\t\\t\\t\\t$cart[$key][\'price\'] = $product->getPrice();\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\\t$miniShop2->cart->set($cart);\\n\\t\\t}\\n\\t\\tunset($_SESSION[\'minishop2\'][\'cart_reload\']);\\n\\t\\tbreak;\\n}"}',
        'guid' => '3ac2d737f4be03608c0646ce065cdbef',
        'native_key' => NULL,
        'signature' => '573316442a906845abf4a9bfddce6513',
        'related_objects' => 
        array (
          'PluginEvents' => 
          array (
            '37215c70152f632629c71eb5362d9205' => 
            array (
              'preserve_keys' => true,
              'update_object' => true,
              'unique_key' => 
              array (
                0 => 'pluginid',
                1 => 'event',
              ),
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"msOnGetProductPrice","priority":0,"propertyset":0}',
              'guid' => '03f605e9c44fa73b4d5828df5930256f',
              'native_key' => 
              array (
                0 => 0,
                1 => 'msOnGetProductPrice',
              ),
              'signature' => '65add3862670c76875c78e9e9460d8f5',
            ),
            '56ad42d2ea31ded34b538d45eeb57ed4' => 
            array (
              'preserve_keys' => true,
              'update_object' => true,
              'unique_key' => 
              array (
                0 => 'pluginid',
                1 => 'event',
              ),
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"msOnChangeOrderStatus","priority":10,"propertyset":0}',
              'guid' => 'f54aba07516e8cf84f2b3d78766af93d',
              'native_key' => 
              array (
                0 => 0,
                1 => 'msOnChangeOrderStatus',
              ),
              'signature' => 'bd12ab097e52ef8daf1a3333b533943a',
            ),
            'a32b2db33b8b367374229c71a2c8c9b9' => 
            array (
              'preserve_keys' => true,
              'update_object' => true,
              'unique_key' => 
              array (
                0 => 'pluginid',
                1 => 'event',
              ),
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"msOnBeforeAddToOrder","priority":0,"propertyset":0}',
              'guid' => '9ddf7c0898e720dc545cf92634e0d04f',
              'native_key' => 
              array (
                0 => 0,
                1 => 'msOnBeforeAddToOrder',
              ),
              'signature' => '40fd9c9db180126bb98c4f55959700fd',
            ),
            '45ea551542e37d67cad6d5be4a35e2e6' => 
            array (
              'preserve_keys' => true,
              'update_object' => true,
              'unique_key' => 
              array (
                0 => 'pluginid',
                1 => 'event',
              ),
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"msOnGetOrderCost","priority":10,"propertyset":0}',
              'guid' => '925a7304a8a5924ed420623ed4b6eb91',
              'native_key' => 
              array (
                0 => 0,
                1 => 'msOnGetOrderCost',
              ),
              'signature' => 'eaf827fd6ef0f28ea61a427acd795709',
            ),
            'c901b31ebe2ef9bceba8e663945b3d1f' => 
            array (
              'preserve_keys' => true,
              'update_object' => true,
              'unique_key' => 
              array (
                0 => 'pluginid',
                1 => 'event',
              ),
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"msOnCreateOrder","priority":0,"propertyset":0}',
              'guid' => '81e5bb70f5acf3a44e231c572169bcef',
              'native_key' => 
              array (
                0 => 0,
                1 => 'msOnCreateOrder',
              ),
              'signature' => 'fe08e4c7a9180705539ba364df48203c',
            ),
            '96b1891b2540ad3b05976fe3c9920727' => 
            array (
              'preserve_keys' => true,
              'update_object' => true,
              'unique_key' => 
              array (
                0 => 'pluginid',
                1 => 'event',
              ),
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnWebLogin","priority":0,"propertyset":0}',
              'guid' => '3206f6862814a73f2ca82ad5fe8e4ce9',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnWebLogin',
              ),
              'signature' => '53860271f63d571a79977c053d5fa95b',
            ),
            'fd12741e9c0ded5462dbd076eb9b0b6f' => 
            array (
              'preserve_keys' => true,
              'update_object' => true,
              'unique_key' => 
              array (
                0 => 'pluginid',
                1 => 'event',
              ),
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnWebLogout","priority":0,"propertyset":0}',
              'guid' => '3ee00ccd93591883096e610a9c8f9830',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnWebLogout',
              ),
              'signature' => 'fc1234500c2995becc0da5deac17952b',
            ),
            'f6c95a87eccb3cb977d763a79054076d' => 
            array (
              'preserve_keys' => true,
              'update_object' => true,
              'unique_key' => 
              array (
                0 => 'pluginid',
                1 => 'event',
              ),
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnLoadWebDocument","priority":0,"propertyset":0}',
              'guid' => 'f44668153caadf2e7cdf85c703e43bd0',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnLoadWebDocument',
              ),
              'signature' => 'c048880221839f29596c987e4a8e9db8',
            ),
          ),
        ),
      ),
    ),
  ),
  'related_object_attributes' => 
  array (
    'Snippets' => 
    array (
      'preserve_keys' => false,
      'update_object' => true,
      'unique_key' => 'name',
    ),
    'Chunks' => 
    array (
      'preserve_keys' => false,
      'update_object' => false,
      'unique_key' => 'name',
    ),
    'Plugins' => 
    array (
      'preserve_keys' => false,
      'update_object' => true,
      'unique_key' => 'name',
    ),
    'PluginEvents' => 
    array (
      'preserve_keys' => true,
      'update_object' => true,
      'unique_key' => 
      array (
        0 => 'pluginid',
        1 => 'event',
      ),
    ),
  ),
  'namespace' => 'msdiscount',
  'resolve' => 
  array (
    0 => 
    array (
      'type' => 'file',
      'body' => '{"source":"msdiscount-1.1.4-pl1\\/modCategory\\/c16594d16f18c49182dbbf2b63ea061b\\/0\\/","target":"return MODX_ASSETS_PATH . \'components\\/\';","name":"msdiscount"}',
    ),
    1 => 
    array (
      'type' => 'file',
      'body' => '{"source":"msdiscount-1.1.4-pl1\\/modCategory\\/c16594d16f18c49182dbbf2b63ea061b\\/1\\/","target":"return MODX_CORE_PATH . \'components\\/\';","name":"msdiscount"}',
    ),
    2 => 
    array (
      'type' => 'php',
      'body' => '{"source":"msdiscount-1.1.4-pl1\\/modCategory\\/c16594d16f18c49182dbbf2b63ea061b.resolve.tables.resolver","type":"php","name":"resolve.tables"}',
    ),
    3 => 
    array (
      'type' => 'php',
      'body' => '{"source":"msdiscount-1.1.4-pl1\\/modCategory\\/c16594d16f18c49182dbbf2b63ea061b.resolve.extension.resolver","type":"php","name":"resolve.extension"}',
    ),
    4 => 
    array (
      'type' => 'php',
      'body' => '{"source":"msdiscount-1.1.4-pl1\\/modCategory\\/c16594d16f18c49182dbbf2b63ea061b.resolve.policy.resolver","type":"php","name":"resolve.policy"}',
    ),
    5 => 
    array (
      'type' => 'php',
      'body' => '{"source":"msdiscount-1.1.4-pl1\\/modCategory\\/c16594d16f18c49182dbbf2b63ea061b.resolve.setup.resolver","type":"php","name":"resolve.setup"}',
    ),
  ),
  'validate' => NULL,
  'vehicle_package' => 'transport',
  'vehicle_class' => 'xPDOObjectVehicle',
  'guid' => 'b1285661c268674fc41f58c15cf94405',
  'package' => 'modx',
  'class' => 'modCategory',
  'signature' => 'c16594d16f18c49182dbbf2b63ea061b',
  'native_key' => NULL,
  'object' => '{"id":null,"parent":0,"category":"msDiscount","rank":0}',
);