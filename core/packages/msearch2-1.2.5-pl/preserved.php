<?php return array (
  '98750a3e2e75867f88812c69f63e36d9' => 
  array (
    'criteria' => 
    array (
      'name' => 'msearch2',
    ),
    'object' => 
    array (
      'name' => 'msearch2',
      'path' => '{core_path}components/msearch2/',
      'assets_path' => '',
    ),
  ),
  '025924f190fc5b0edb64865cb72e8a65' => 
  array (
    'criteria' => 
    array (
      'key' => 'mse2_frontend_css',
    ),
    'object' => 
    array (
      'key' => 'mse2_frontend_css',
      'value' => '',
      'xtype' => 'textfield',
      'namespace' => 'msearch2',
      'area' => 'mse2_main',
      'editedon' => '2015-03-03 03:38:43',
    ),
  ),
  '2468798ba314822614a3c164253f1f78' => 
  array (
    'criteria' => 
    array (
      'key' => 'mse2_frontend_js',
    ),
    'object' => 
    array (
      'key' => 'mse2_frontend_js',
      'value' => '[[+jsUrl]]web/custom.js',
      'xtype' => 'textfield',
      'namespace' => 'msearch2',
      'area' => 'mse2_main',
      'editedon' => '2015-03-03 16:27:16',
    ),
  ),
  '9861539c781c2fa63370a5dcb7d46a69' => 
  array (
    'criteria' => 
    array (
      'key' => 'mse2_index_fields',
    ),
    'object' => 
    array (
      'key' => 'mse2_index_fields',
      'value' => 'content:3,description:2,introtext:2,pagetitle:3,longtitle:3',
      'xtype' => 'textarea',
      'namespace' => 'msearch2',
      'area' => 'mse2_index',
      'editedon' => '0000-00-00 00:00:00',
    ),
  ),
  'fb9676176a23fe605bc264bff225e998' => 
  array (
    'criteria' => 
    array (
      'key' => 'mse2_index_comments',
    ),
    'object' => 
    array (
      'key' => 'mse2_index_comments',
      'value' => '1',
      'xtype' => 'combo-boolean',
      'namespace' => 'msearch2',
      'area' => 'mse2_index',
      'editedon' => '0000-00-00 00:00:00',
    ),
  ),
  '593a999a9aa99be8ff740253f7b95a62' => 
  array (
    'criteria' => 
    array (
      'key' => 'mse2_index_comments_weight',
    ),
    'object' => 
    array (
      'key' => 'mse2_index_comments_weight',
      'value' => '1',
      'xtype' => 'numberfield',
      'namespace' => 'msearch2',
      'area' => 'mse2_index',
      'editedon' => '0000-00-00 00:00:00',
    ),
  ),
  '38f769dfac8117897676f48e253dbf4c' => 
  array (
    'criteria' => 
    array (
      'key' => 'mse2_index_min_words_length',
    ),
    'object' => 
    array (
      'key' => 'mse2_index_min_words_length',
      'value' => '4',
      'xtype' => 'numberfield',
      'namespace' => 'msearch2',
      'area' => 'mse2_index',
      'editedon' => '0000-00-00 00:00:00',
    ),
  ),
  'e2e26c5463a94af4ee1bb2abd2a75605' => 
  array (
    'criteria' => 
    array (
      'key' => 'mse2_search_exact_match_bonus',
    ),
    'object' => 
    array (
      'key' => 'mse2_search_exact_match_bonus',
      'value' => '5',
      'xtype' => 'numberfield',
      'namespace' => 'msearch2',
      'area' => 'mse2_search',
      'editedon' => '0000-00-00 00:00:00',
    ),
  ),
  'd4e2cafe17eb9afc9f5e58db8956ec6f' => 
  array (
    'criteria' => 
    array (
      'key' => 'mse2_search_all_words_bonus',
    ),
    'object' => 
    array (
      'key' => 'mse2_search_all_words_bonus',
      'value' => '5',
      'xtype' => 'numberfield',
      'namespace' => 'msearch2',
      'area' => 'mse2_search',
      'editedon' => '0000-00-00 00:00:00',
    ),
  ),
  '5e75c47a9327eca4dba79739abbbeb91' => 
  array (
    'criteria' => 
    array (
      'key' => 'mse2_search_like_match_bonus',
    ),
    'object' => 
    array (
      'key' => 'mse2_search_like_match_bonus',
      'value' => '3',
      'xtype' => 'numberfield',
      'namespace' => 'msearch2',
      'area' => 'mse2_search',
      'editedon' => '0000-00-00 00:00:00',
    ),
  ),
  '79cb2e445fceee03dfa33a916710f1d5' => 
  array (
    'criteria' => 
    array (
      'key' => 'mse2_search_split_words',
    ),
    'object' => 
    array (
      'key' => 'mse2_search_split_words',
      'value' => '#\\s#',
      'xtype' => 'textfield',
      'namespace' => 'msearch2',
      'area' => 'mse2_search',
      'editedon' => '0000-00-00 00:00:00',
    ),
  ),
  'a2d81ee94d0ec59df000854848e0209f' => 
  array (
    'criteria' => 
    array (
      'key' => 'mse2_filters_handler_class',
    ),
    'object' => 
    array (
      'key' => 'mse2_filters_handler_class',
      'value' => 'mse2FiltersHandler',
      'xtype' => 'textfield',
      'namespace' => 'msearch2',
      'area' => 'mse2_main',
      'editedon' => '0000-00-00 00:00:00',
    ),
  ),
  'f128e9ff35ff052a8b070e517ed9406c' => 
  array (
    'criteria' => 
    array (
      'namespace' => 'msearch2',
      'controller' => 'index',
    ),
    'object' => 
    array (
      'id' => 7,
      'namespace' => 'msearch2',
      'controller' => 'index',
      'haslayout' => 1,
      'lang_topics' => 'msearch2:default',
      'assets' => '',
      'help_url' => '',
    ),
  ),
  '67b089d40e15179eb0ab816d48dd4f32' => 
  array (
    'criteria' => 
    array (
      'text' => 'msearch2',
    ),
    'object' => 
    array (
      'text' => 'msearch2',
      'parent' => 'components',
      'action' => '7',
      'description' => 'mse2_menu_desc',
      'icon' => 'images/icons/plugin.gif',
      'menuindex' => 0,
      'params' => '',
      'handler' => '',
      'permissions' => '',
      'namespace' => 'core',
    ),
  ),
  '8c0790aba5d55bd0178c5269fcfb6283' => 
  array (
    'criteria' => 
    array (
      'category' => 'mSearch2',
    ),
    'object' => 
    array (
      'id' => 13,
      'parent' => 0,
      'category' => 'mSearch2',
    ),
  ),
  '5f8de9129c0341d6776f205419bd0a70' => 
  array (
    'criteria' => 
    array (
      'name' => 'tpl.mSearch2.row',
    ),
    'object' => 
    array (
      'id' => 35,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'tpl.mSearch2.row',
      'description' => '',
      'editor_type' => 0,
      'category' => 13,
      'cache_type' => 0,
      'snippet' => '<div class="mse2-row">
	[[+idx]]. <a href="[[+uri]]" class="search-link">[[+pagetitle]]</a>[[+weight]]
	[[+intro]]
</div>
<!--msearch2_weight  ([[%mse2_weight]]: [[+weight]])-->
<!--msearch2_intro <p>[[+intro]]</p>-->',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => 'core/components/msearch2/elements/chunks/chunk.msearch2.row.tpl',
      'content' => '<div class="mse2-row">
	[[+idx]]. <a href="[[+uri]]" class="search-link">[[+pagetitle]]</a>[[+weight]]
	[[+intro]]
</div>
<!--msearch2_weight  ([[%mse2_weight]]: [[+weight]])-->
<!--msearch2_intro <p>[[+intro]]</p>-->',
    ),
  ),
  'fa3e4a15ef5f2e1a9604b710d13d8518' => 
  array (
    'criteria' => 
    array (
      'name' => 'tpl.mSearch2.form',
    ),
    'object' => 
    array (
      'id' => 36,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'tpl.mSearch2.form',
      'description' => '',
      'editor_type' => 0,
      'category' => 13,
      'cache_type' => 0,
      'snippet' => '<form action="[[~[[+pageId]]]]" method="get" class="well msearch2" id="mse2_form">
	<div class="row">
		<div class="form-group col-md-10">
			<input type="text" class="form-control" name="[[+queryVar]]" placeholder="[[%mse2_search]]" value="[[+mse2_query]]" />
		</div>
		<button type="submit" class="btn btn-default">
			<i class="glyphicon glyphicon-search"></i> [[%search]]
		</button>
	</div>
</form>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => 'core/components/msearch2/elements/chunks/chunk.msearch2.form.tpl',
      'content' => '<form action="[[~[[+pageId]]]]" method="get" class="well msearch2" id="mse2_form">
	<div class="row">
		<div class="form-group col-md-10">
			<input type="text" class="form-control" name="[[+queryVar]]" placeholder="[[%mse2_search]]" value="[[+mse2_query]]" />
		</div>
		<button type="submit" class="btn btn-default">
			<i class="glyphicon glyphicon-search"></i> [[%search]]
		</button>
	</div>
</form>',
    ),
  ),
  'cb495a9eaf0cd25bf0ef068a9092420c' => 
  array (
    'criteria' => 
    array (
      'name' => 'tpl.mSearch2.ac',
    ),
    'object' => 
    array (
      'id' => 37,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'tpl.mSearch2.ac',
      'description' => '',
      'editor_type' => 0,
      'category' => 13,
      'cache_type' => 0,
      'snippet' => '<div class="mse2-ac-item">
	[[+idx]]. [[+pagetitle]] [[+weight]]
	[[+intro]]
</div>
<!--msearch2_weight <span class="mse2-ac-weight"><small>[[%mse2_weight]]: [[+weight]]</small></span>-->
<!--msearch2_intro <br/><small>[[+intro]]</small>-->',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => 'core/components/msearch2/elements/chunks/chunk.msearch2.ac.tpl',
      'content' => '<div class="mse2-ac-item">
	[[+idx]]. [[+pagetitle]] [[+weight]]
	[[+intro]]
</div>
<!--msearch2_weight <span class="mse2-ac-weight"><small>[[%mse2_weight]]: [[+weight]]</small></span>-->
<!--msearch2_intro <br/><small>[[+intro]]</small>-->',
    ),
  ),
  '147218741cb8172e3496038cc39632b5' => 
  array (
    'criteria' => 
    array (
      'name' => 'tpl.mFilter2.outer',
    ),
    'object' => 
    array (
      'id' => 38,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'tpl.mFilter2.outer',
      'description' => '',
      'editor_type' => 0,
      'category' => 13,
      'cache_type' => 0,
      'snippet' => '<div class="row msearch2" id="mse2_mfilter">
	<div class="span3 col-md-3">
		<form action="" method="post" id="mse2_filters">
			[[+filters]]
		</form>

		<br/>
		<div>[[%mse2_limit]]
			<select name="mse_limit" id="mse2_limit">
				<option value="10" [[+limit:is=`10`:then=`selected`]]>10</option>
				<option value="25" [[+limit:is=`25`:then=`selected`]]>25</option>
				<option value="50" [[+limit:is=`50`:then=`selected`]]>50</option>
				<option value="100" [[+limit:is=`100`:then=`selected`]]>100</option>
			</select>
		</div>
	</div>

	<div class="span9 col-md-9">
		<h3>[[%mse2_filter_total]] <span id="mse2_total">[[+total:default=`0`]]</span></h3>

		<div class="row">
			<div id="mse2_sort" class="span5 col-md-5">
				[[%mse2_sort]]
				<a href="#" data-sort="resource|publishedon" data-dir="[[+mse2_sort:is=`resource|publishedon:desc`:then=`desc`]]" data-default="desc" class="sort">[[%mse2_sort_publishedon]] <span></span></a>
			</div>

			[[+tpls:notempty=`
			<div id="mse2_tpl" class="span4 col-md-4">
				<a href="#" data-tpl="0" class="[[+tpl0]]">[[%mse2_chunk_default]]</a> /
				<a href="#" data-tpl="1" class="[[+tpl1]]">[[%mse2_chunk_alternate]]</a>
			</div>
			`]]
		</div>

		<div id="mse2_selected_wrapper">
			<div id="mse2_selected">[[%mse2_selected]]:
				<span></span>
			</div>
		</div>

		<div id="mse2_results">
			[[+results]]
		</div>

		<div class="pagination">
			<ul id="mse2_pagination">
				[[!+page.nav]]
			</ul>
		</div>

	</div>
</div>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => 'core/components/msearch2/elements/chunks/chunk.mfilter2.outer.tpl',
      'content' => '<div class="row msearch2" id="mse2_mfilter">
	<div class="span3 col-md-3">
		<form action="" method="post" id="mse2_filters">
			[[+filters]]
		</form>

		<br/>
		<div>[[%mse2_limit]]
			<select name="mse_limit" id="mse2_limit">
				<option value="10" [[+limit:is=`10`:then=`selected`]]>10</option>
				<option value="25" [[+limit:is=`25`:then=`selected`]]>25</option>
				<option value="50" [[+limit:is=`50`:then=`selected`]]>50</option>
				<option value="100" [[+limit:is=`100`:then=`selected`]]>100</option>
			</select>
		</div>
	</div>

	<div class="span9 col-md-9">
		<h3>[[%mse2_filter_total]] <span id="mse2_total">[[+total:default=`0`]]</span></h3>

		<div class="row">
			<div id="mse2_sort" class="span5 col-md-5">
				[[%mse2_sort]]
				<a href="#" data-sort="resource|publishedon" data-dir="[[+mse2_sort:is=`resource|publishedon:desc`:then=`desc`]]" data-default="desc" class="sort">[[%mse2_sort_publishedon]] <span></span></a>
			</div>

			[[+tpls:notempty=`
			<div id="mse2_tpl" class="span4 col-md-4">
				<a href="#" data-tpl="0" class="[[+tpl0]]">[[%mse2_chunk_default]]</a> /
				<a href="#" data-tpl="1" class="[[+tpl1]]">[[%mse2_chunk_alternate]]</a>
			</div>
			`]]
		</div>

		<div id="mse2_selected_wrapper">
			<div id="mse2_selected">[[%mse2_selected]]:
				<span></span>
			</div>
		</div>

		<div id="mse2_results">
			[[+results]]
		</div>

		<div class="pagination">
			<ul id="mse2_pagination">
				[[!+page.nav]]
			</ul>
		</div>

	</div>
</div>',
    ),
  ),
  '2fa81cbb7caa5eb6007b9758d98db03a' => 
  array (
    'criteria' => 
    array (
      'name' => 'tpl.mFilter2.filter.outer',
    ),
    'object' => 
    array (
      'id' => 39,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'tpl.mFilter2.filter.outer',
      'description' => '',
      'editor_type' => 0,
      'category' => 13,
      'cache_type' => 0,
      'snippet' => '<fieldset id="mse2_[[+table]][[+delimeter]][[+filter]]">
	<h4>[[%mse2_filter_[[+table]]_[[+filter]]]]</h4>
	[[+rows]]
</fieldset>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => 'core/components/msearch2/elements/chunks/chunk.mfilter2.filter.outer.tpl',
      'content' => '<fieldset id="mse2_[[+table]][[+delimeter]][[+filter]]">
	<h4>[[%mse2_filter_[[+table]]_[[+filter]]]]</h4>
	[[+rows]]
</fieldset>',
    ),
  ),
  '1467f1dd786381b8db49e6b2c12e8d6a' => 
  array (
    'criteria' => 
    array (
      'name' => 'tpl.mFilter2.filter.slider',
    ),
    'object' => 
    array (
      'id' => 40,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'tpl.mFilter2.filter.slider',
      'description' => '',
      'editor_type' => 0,
      'category' => 13,
      'cache_type' => 0,
      'snippet' => '<fieldset id="mse2_[[+table]][[+delimeter]][[+filter]]">
	<h4>[[%mse2_filter_[[+table]]_[[+filter]]]]</h4>
	<div class="mse2_number_slider"></div>
	<div class="mse2_number_inputs">
		[[+rows]]
	</div>
</fieldset>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => 'core/components/msearch2/elements/chunks/chunk.mfilter2.filter.slider.tpl',
      'content' => '<fieldset id="mse2_[[+table]][[+delimeter]][[+filter]]">
	<h4>[[%mse2_filter_[[+table]]_[[+filter]]]]</h4>
	<div class="mse2_number_slider"></div>
	<div class="mse2_number_inputs">
		[[+rows]]
	</div>
</fieldset>',
    ),
  ),
  '7d028cb9b4c9be7ce2aa1f18ecc1bd3d' => 
  array (
    'criteria' => 
    array (
      'name' => 'tpl.mFilter2.filter.select',
    ),
    'object' => 
    array (
      'id' => 41,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'tpl.mFilter2.filter.select',
      'description' => '',
      'editor_type' => 0,
      'category' => 13,
      'cache_type' => 0,
      'snippet' => '<fieldset id="mse2_[[+table]][[+delimeter]][[+filter]]">
	<h4>[[%mse2_filter_[[+table]]_[[+filter]]]]</h4>
	<select name="[[+table]][[+delimeter]][[+filter]]" id="[[+table]][[+delimeter]][[+filter]]_0">
		<option value="" selected>[[%mse2_select]]</option>
		[[+rows]]
	</select>
</fieldset>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => 'core/components/msearch2/elements/chunks/chunk.mfilter2.filter.select.tpl',
      'content' => '<fieldset id="mse2_[[+table]][[+delimeter]][[+filter]]">
	<h4>[[%mse2_filter_[[+table]]_[[+filter]]]]</h4>
	<select name="[[+table]][[+delimeter]][[+filter]]" id="[[+table]][[+delimeter]][[+filter]]_0">
		<option value="" selected>[[%mse2_select]]</option>
		[[+rows]]
	</select>
</fieldset>',
    ),
  ),
  '21dfe2c1d2a345f1da340ba167f404ed' => 
  array (
    'criteria' => 
    array (
      'name' => 'tpl.mFilter2.filter.checkbox',
    ),
    'object' => 
    array (
      'id' => 42,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'tpl.mFilter2.filter.checkbox',
      'description' => '',
      'editor_type' => 0,
      'category' => 13,
      'cache_type' => 0,
      'snippet' => '<label for="mse2_[[+table]][[+delimeter]][[+filter]]_[[+idx]]" class="[[+disabled]]">
	<input type="checkbox" name="[[+table]][[+delimeter]][[+filter]]" id="mse2_[[+table]][[+delimeter]][[+filter]]_[[+idx]]" value="[[+value]]" [[+checked]] [[+disabled]]/> [[+title]] <sup>[[+num]]</sup>
</label><br/>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => 'core/components/msearch2/elements/chunks/chunk.mfilter2.filter.checkbox.tpl',
      'content' => '<label for="mse2_[[+table]][[+delimeter]][[+filter]]_[[+idx]]" class="[[+disabled]]">
	<input type="checkbox" name="[[+table]][[+delimeter]][[+filter]]" id="mse2_[[+table]][[+delimeter]][[+filter]]_[[+idx]]" value="[[+value]]" [[+checked]] [[+disabled]]/> [[+title]] <sup>[[+num]]</sup>
</label><br/>',
    ),
  ),
  'a2f7e1d4522ce964809f8141179b043f' => 
  array (
    'criteria' => 
    array (
      'name' => 'tpl.mFilter2.filter.number',
    ),
    'object' => 
    array (
      'id' => 43,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'tpl.mFilter2.filter.number',
      'description' => '',
      'editor_type' => 0,
      'category' => 13,
      'cache_type' => 0,
      'snippet' => '<div class="form-group col-md-6">
	<label for="mse2_[[+table]][[+delimeter]][[+filter]]_[[+idx]]">[[+title]]
		<input type="input" name="[[+table]][[+delimeter]][[+filter]]" id="mse2_[[+table]][[+delimeter]][[+filter]]_[[+idx]]" value="[[+value]]" class="form-control input-sm" />
	</label>
</div>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => 'core/components/msearch2/elements/chunks/chunk.mfilter2.filter.number.tpl',
      'content' => '<div class="form-group col-md-6">
	<label for="mse2_[[+table]][[+delimeter]][[+filter]]_[[+idx]]">[[+title]]
		<input type="input" name="[[+table]][[+delimeter]][[+filter]]" id="mse2_[[+table]][[+delimeter]][[+filter]]_[[+idx]]" value="[[+value]]" class="form-control input-sm" />
	</label>
</div>',
    ),
  ),
  '096c287af8b32050c4b32a2f1f52f57c' => 
  array (
    'criteria' => 
    array (
      'name' => 'tpl.mFilter2.filter.radio',
    ),
    'object' => 
    array (
      'id' => 44,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'tpl.mFilter2.filter.radio',
      'description' => '',
      'editor_type' => 0,
      'category' => 13,
      'cache_type' => 0,
      'snippet' => '<label for="mse2_[[+table]][[+delimeter]][[+filter]]_[[+idx]]" class="[[+disabled]]">
	<input type="radio" name="[[+table]][[+delimeter]][[+filter]]" id="mse2_[[+table]][[+delimeter]][[+filter]]_[[+idx]]" value="[[+value]]" [[+checked]] [[+disabled]]/> [[+title]] <sup>[[+num]]</sup>
</label><br/>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => 'core/components/msearch2/elements/chunks/chunk.mfilter2.filter.radio.tpl',
      'content' => '<label for="mse2_[[+table]][[+delimeter]][[+filter]]_[[+idx]]" class="[[+disabled]]">
	<input type="radio" name="[[+table]][[+delimeter]][[+filter]]" id="mse2_[[+table]][[+delimeter]][[+filter]]_[[+idx]]" value="[[+value]]" [[+checked]] [[+disabled]]/> [[+title]] <sup>[[+num]]</sup>
</label><br/>',
    ),
  ),
  '5734994242f4a4f34265f0b35deb8d2b' => 
  array (
    'criteria' => 
    array (
      'name' => 'tpl.mFilter2.filter.option',
    ),
    'object' => 
    array (
      'id' => 45,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'tpl.mFilter2.filter.option',
      'description' => '',
      'editor_type' => 0,
      'category' => 13,
      'cache_type' => 0,
      'snippet' => '<option value="[[+value]]" [[+selected]] [[+disabled]] class="[[+disabled]]">[[+title]]&nbsp;[[+num]]</option>

<!--pdotools_num ([[+num]])-->',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => 'core/components/msearch2/elements/chunks/chunk.mfilter2.filter.option.tpl',
      'content' => '<option value="[[+value]]" [[+selected]] [[+disabled]] class="[[+disabled]]">[[+title]]&nbsp;[[+num]]</option>

<!--pdotools_num ([[+num]])-->',
    ),
  ),
  '0295738ef1c132cdc74943d65cae0fb6' => 
  array (
    'criteria' => 
    array (
      'name' => 'mSearch2',
    ),
    'object' => 
    array (
      'id' => 23,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'mSearch2',
      'description' => '',
      'editor_type' => 0,
      'category' => 13,
      'cache_type' => 0,
      'snippet' => '/** @var array $scriptProperties */
/** @var pdoFetch $pdoFetch */
$fqn = $modx->getOption(\'pdoFetch.class\', null, \'pdotools.pdofetch\', true);
if (!$pdoClass = $modx->loadClass($fqn, \'\', false, true)) {return false;}
$pdoFetch = new $pdoClass($modx, $scriptProperties);
$pdoFetch->addTime(\'pdoTools loaded.\');
/** @var mSearch2 $mSearch2 */
if (!$modx->loadClass(\'msearch2\', MODX_CORE_PATH . \'components/msearch2/model/msearch2/\', false, true)) {return false;}
$mSearch2 = new mSearch2($modx, $scriptProperties, $pdoFetch);

if (empty($queryVar)) {$queryVar = \'query\';}
if (empty($parentsVar)) {$parentsVar = \'parents\';}
if (empty($minQuery)) {$minQuery = $modx->getOption(\'index_min_words_length\', null, 3, true);}
if (empty($htagOpen)) {$htagOpen = \'<b>\';}
if (empty($htagClose)) {$htagClose = \'</b>\';}
if (empty($outputSeparator)) {$outputSeparator = "\\n";}
if (empty($plPrefix)) {$plPrefix = \'mse2_\';}
$returnIds = !empty($returnIds);
$fastMode = !empty($fastMode);

$class = \'modResource\';
$found = array();
$output = null;
$query = !empty($_REQUEST[$queryVar])
	? htmlspecialchars(strip_tags(trim($_REQUEST[$queryVar])))
	: \'\';

if (empty($resources)) {
	if (empty($query) && isset($_REQUEST[$queryVar])) {
		$output = $modx->lexicon(\'mse2_err_no_query\');
	}
	elseif (empty($query) && !empty($forceSearch)) {
		$output = $modx->lexicon(\'mse2_err_no_query_var\');
	}
	elseif (!empty($query) && !preg_match(\'/^[0-9]{2,}$/\', $query) && mb_strlen($query,\'UTF-8\') < $minQuery) {
		$output = $modx->lexicon(\'mse2_err_min_query\');
	}

	$modx->setPlaceholder($plPrefix.$queryVar, $query);

	if (!empty($output)) {
		return !$returnIds
			? $output
			: \'\';
	}
	elseif (!empty($query)) {
		$found = $mSearch2->Search($query);
		$ids = array_keys($found);
		$resources = implode(\',\', $ids);
		if (empty($found)) {
			if ($returnIds) {
				return \'\';
			}
			elseif (!empty($query)) {
				$output = $modx->lexicon(\'mse2_err_no_results\');
			}
			if (!empty($tplWrapper) && !empty($wrapIfEmpty)) {
				$output = $pdoFetch->getChunk(
					$tplWrapper,
					array(
						\'output\' => $output,
						\'total\' => 0,
						\'query\' => $query,
						\'parents\' => $modx->getPlaceholder($plPrefix.$parentsVar),
					),
					$fastMode
				);
			}
			if ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {
				$output .= \'<pre class="mSearchLog">\' . print_r($pdoFetch->getTime(), 1) . \'</pre>\';
			}
			if (!empty($toPlaceholder)) {
				$modx->setPlaceholder($toPlaceholder, $output);
				return;
			}
			else {
				return $output;
			}
		}
	}
}
elseif (strpos($resources, \'{\') === 0) {
	$found = $modx->fromJSON($resources);
	$resources = implode(\',\', array_keys($found));
	unset($scriptProperties[\'resources\']);
}
/*----------------------------------------------------------------------------------*/
// Joining tables
$leftJoin = array(
	\'mseIntro\' => array(
		\'class\' => \'mseIntro\',
		\'alias\' => \'Intro\',
		\'on\' => \'`modResource`.`id`=`Intro`.`resource`\'
	)
);
// Fields to select
$resourceColumns = !empty($includeContent)
	? $modx->getSelectColumns($class, $class)
	: $modx->getSelectColumns($class, $class, \'\', array(\'content\'), true);
$select = array(
	$class => $resourceColumns,
	\'Intro\' => \'intro\'
);

// Add custom parameters
foreach (array(\'leftJoin\',\'select\') as $v) {
	if (!empty($scriptProperties[$v])) {
		$tmp = $modx->fromJSON($scriptProperties[$v]);
		if (is_array($tmp)) {
			$$v = array_merge($$v, $tmp);
		}
	}
	unset($scriptProperties[$v]);
}

// Default parameters
$default = array(
	\'class\' => $class,
	//,\'where\' => $modx->toJSON($where),
	\'leftJoin\' => $modx->toJSON($leftJoin),
	\'select\' => $modx->toJSON($select),
	\'groupby\' => $class.\'.id\',
	\'fastMode\' => $fastMode,
	\'return\' => !empty($returnIds)
			? \'ids\'
			: \'data\',
	\'nestedChunkPrefix\' => \'msearch2_\',
);
if (!empty($resources)) {
	$default[\'resources\'] = is_array($resources)
		? implode(\',\', $resources)
		: $resources;
}

// Merge all properties and run!
$pdoFetch->setConfig(array_merge($default, $scriptProperties), false);
$pdoFetch->addTime(\'Query parameters are prepared.\');
$rows = $pdoFetch->run();

// Processing results
if ($returnIds) {
	return $rows;
}
elseif (!empty($rows) && is_array($rows)) {
	$output = array();
	foreach ($rows as $k => $row) {
		// Processing main fields
		$row[\'weight\'] = isset($found[$row[\'id\']]) ? $found[$row[\'id\']] : \'\';
		$row[\'intro\'] = $mSearch2->Highlight($row[\'intro\'], $query, $htagOpen, $htagClose);

		$row[\'idx\'] = $pdoFetch->idx++;
		$tplRow = $pdoFetch->defineChunk($row);
		$output[] .= empty($tplRow)
			? $pdoFetch->getChunk(\'\', $row)
			: $pdoFetch->getChunk($tplRow, $row, $fastMode);
	}
	$pdoFetch->addTime(\'Returning processed chunks\');
	if (!empty($output)) {
		$output = implode($outputSeparator, $output);
	}
}
else {
	$output = $modx->lexicon(\'mse2_err_no_results\');
}

if ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {
	$output .= \'<pre class="mSearchLog">\' . print_r($pdoFetch->getTime(), 1) . \'</pre>\';
}

// Return output
if (!empty($tplWrapper) && (!empty($wrapIfEmpty) || !empty($output))) {
	$output = $pdoFetch->getChunk(
		$tplWrapper,
		array(
			\'output\' => $output,
			\'total\' => $modx->getPlaceholder($pdoFetch->config[\'totalVar\']),
			\'query\' => $modx->getPlaceholder($plPrefix.$queryVar),
			\'parents\' => $modx->getPlaceholder($plPrefix.$parentsVar),
		),
		$fastMode
	);
}

if (!empty($toPlaceholder)) {
	$modx->setPlaceholder($toPlaceholder, $output);
}
else {
	return $output;
}',
      'locked' => 0,
      'properties' => 'a:29:{s:3:"tpl";a:7:{s:4:"name";s:3:"tpl";s:4:"desc";s:13:"mse2_prop_tpl";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:16:"tpl.mSearch2.row";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:9:"returnIds";a:7:{s:4:"name";s:9:"returnIds";s:4:"desc";s:19:"mse2_prop_returnIds";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:7:"showLog";a:7:{s:4:"name";s:7:"showLog";s:4:"desc";s:17:"mse2_prop_showLog";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:8:"fastMode";a:7:{s:4:"name";s:8:"fastMode";s:4:"desc";s:18:"mse2_prop_fastMode";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:5:"limit";a:7:{s:4:"name";s:5:"limit";s:4:"desc";s:15:"mse2_prop_limit";s:4:"type";s:11:"numberfield";s:7:"options";a:0:{}s:5:"value";i:10;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:6:"offset";a:7:{s:4:"name";s:6:"offset";s:4:"desc";s:16:"mse2_prop_offset";s:4:"type";s:11:"numberfield";s:7:"options";a:0:{}s:5:"value";i:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:5:"depth";a:7:{s:4:"name";s:5:"depth";s:4:"desc";s:15:"mse2_prop_depth";s:4:"type";s:11:"numberfield";s:7:"options";a:0:{}s:5:"value";i:10;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:15:"outputSeparator";a:7:{s:4:"name";s:15:"outputSeparator";s:4:"desc";s:25:"mse2_prop_outputSeparator";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:1:"
";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:13:"toPlaceholder";a:7:{s:4:"name";s:13:"toPlaceholder";s:4:"desc";s:23:"mse2_prop_toPlaceholder";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:7:"parents";a:7:{s:4:"name";s:7:"parents";s:4:"desc";s:17:"mse2_prop_parents";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:10:"includeTVs";a:7:{s:4:"name";s:10:"includeTVs";s:4:"desc";s:20:"mse2_prop_includeTVs";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:8:"tvPrefix";a:7:{s:4:"name";s:8:"tvPrefix";s:4:"desc";s:18:"mse2_prop_tvPrefix";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:5:"where";a:7:{s:4:"name";s:5:"where";s:4:"desc";s:15:"mse2_prop_where";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:15:"showUnpublished";a:7:{s:4:"name";s:15:"showUnpublished";s:4:"desc";s:25:"mse2_prop_showUnpublished";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:11:"showDeleted";a:7:{s:4:"name";s:11:"showDeleted";s:4:"desc";s:21:"mse2_prop_showDeleted";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:10:"showHidden";a:7:{s:4:"name";s:10:"showHidden";s:4:"desc";s:20:"mse2_prop_showHidden";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:14:"hideContainers";a:7:{s:4:"name";s:14:"hideContainers";s:4:"desc";s:24:"mse2_prop_hideContainers";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:14:"introCutBefore";a:7:{s:4:"name";s:14:"introCutBefore";s:4:"desc";s:24:"mse2_prop_introCutBefore";s:4:"type";s:11:"numberfield";s:7:"options";a:0:{}s:5:"value";i:50;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:13:"introCutAfter";a:7:{s:4:"name";s:13:"introCutAfter";s:4:"desc";s:23:"mse2_prop_introCutAfter";s:4:"type";s:11:"numberfield";s:7:"options";a:0:{}s:5:"value";i:250;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:8:"htagOpen";a:7:{s:4:"name";s:8:"htagOpen";s:4:"desc";s:18:"mse2_prop_htagOpen";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:3:"<b>";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:9:"htagClose";a:7:{s:4:"name";s:9:"htagClose";s:4:"desc";s:19:"mse2_prop_htagClose";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:4:"</b>";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:10:"parentsVar";a:7:{s:4:"name";s:10:"parentsVar";s:4:"desc";s:20:"mse2_prop_parentsVar";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:7:"parents";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:8:"queryVar";a:7:{s:4:"name";s:8:"queryVar";s:4:"desc";s:18:"mse2_prop_queryVar";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:5:"query";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:10:"tplWrapper";a:7:{s:4:"name";s:10:"tplWrapper";s:4:"desc";s:20:"mse2_prop_tplWrapper";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:11:"wrapIfEmpty";a:7:{s:4:"name";s:11:"wrapIfEmpty";s:4:"desc";s:21:"mse2_prop_wrapIfEmpty";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:11:"forceSearch";a:7:{s:4:"name";s:11:"forceSearch";s:4:"desc";s:21:"mse2_prop_forceSearch";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:8:"minQuery";a:7:{s:4:"name";s:8:"minQuery";s:4:"desc";s:18:"mse2_prop_minQuery";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";i:3;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:6:"fields";a:7:{s:4:"name";s:6:"fields";s:4:"desc";s:16:"mse2_prop_fields";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:9:"onlyIndex";a:7:{s:4:"name";s:9:"onlyIndex";s:4:"desc";s:19:"mse2_prop_onlyIndex";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}}',
      'moduleguid' => '',
      'static' => 0,
      'static_file' => 'core/components/msearch2/elements/snippets/snippet.msearch2.php',
      'content' => '/** @var array $scriptProperties */
/** @var pdoFetch $pdoFetch */
$fqn = $modx->getOption(\'pdoFetch.class\', null, \'pdotools.pdofetch\', true);
if (!$pdoClass = $modx->loadClass($fqn, \'\', false, true)) {return false;}
$pdoFetch = new $pdoClass($modx, $scriptProperties);
$pdoFetch->addTime(\'pdoTools loaded.\');
/** @var mSearch2 $mSearch2 */
if (!$modx->loadClass(\'msearch2\', MODX_CORE_PATH . \'components/msearch2/model/msearch2/\', false, true)) {return false;}
$mSearch2 = new mSearch2($modx, $scriptProperties, $pdoFetch);

if (empty($queryVar)) {$queryVar = \'query\';}
if (empty($parentsVar)) {$parentsVar = \'parents\';}
if (empty($minQuery)) {$minQuery = $modx->getOption(\'index_min_words_length\', null, 3, true);}
if (empty($htagOpen)) {$htagOpen = \'<b>\';}
if (empty($htagClose)) {$htagClose = \'</b>\';}
if (empty($outputSeparator)) {$outputSeparator = "\\n";}
if (empty($plPrefix)) {$plPrefix = \'mse2_\';}
$returnIds = !empty($returnIds);
$fastMode = !empty($fastMode);

$class = \'modResource\';
$found = array();
$output = null;
$query = !empty($_REQUEST[$queryVar])
	? htmlspecialchars(strip_tags(trim($_REQUEST[$queryVar])))
	: \'\';

if (empty($resources)) {
	if (empty($query) && isset($_REQUEST[$queryVar])) {
		$output = $modx->lexicon(\'mse2_err_no_query\');
	}
	elseif (empty($query) && !empty($forceSearch)) {
		$output = $modx->lexicon(\'mse2_err_no_query_var\');
	}
	elseif (!empty($query) && !preg_match(\'/^[0-9]{2,}$/\', $query) && mb_strlen($query,\'UTF-8\') < $minQuery) {
		$output = $modx->lexicon(\'mse2_err_min_query\');
	}

	$modx->setPlaceholder($plPrefix.$queryVar, $query);

	if (!empty($output)) {
		return !$returnIds
			? $output
			: \'\';
	}
	elseif (!empty($query)) {
		$found = $mSearch2->Search($query);
		$ids = array_keys($found);
		$resources = implode(\',\', $ids);
		if (empty($found)) {
			if ($returnIds) {
				return \'\';
			}
			elseif (!empty($query)) {
				$output = $modx->lexicon(\'mse2_err_no_results\');
			}
			if (!empty($tplWrapper) && !empty($wrapIfEmpty)) {
				$output = $pdoFetch->getChunk(
					$tplWrapper,
					array(
						\'output\' => $output,
						\'total\' => 0,
						\'query\' => $query,
						\'parents\' => $modx->getPlaceholder($plPrefix.$parentsVar),
					),
					$fastMode
				);
			}
			if ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {
				$output .= \'<pre class="mSearchLog">\' . print_r($pdoFetch->getTime(), 1) . \'</pre>\';
			}
			if (!empty($toPlaceholder)) {
				$modx->setPlaceholder($toPlaceholder, $output);
				return;
			}
			else {
				return $output;
			}
		}
	}
}
elseif (strpos($resources, \'{\') === 0) {
	$found = $modx->fromJSON($resources);
	$resources = implode(\',\', array_keys($found));
	unset($scriptProperties[\'resources\']);
}
/*----------------------------------------------------------------------------------*/
// Joining tables
$leftJoin = array(
	\'mseIntro\' => array(
		\'class\' => \'mseIntro\',
		\'alias\' => \'Intro\',
		\'on\' => \'`modResource`.`id`=`Intro`.`resource`\'
	)
);
// Fields to select
$resourceColumns = !empty($includeContent)
	? $modx->getSelectColumns($class, $class)
	: $modx->getSelectColumns($class, $class, \'\', array(\'content\'), true);
$select = array(
	$class => $resourceColumns,
	\'Intro\' => \'intro\'
);

// Add custom parameters
foreach (array(\'leftJoin\',\'select\') as $v) {
	if (!empty($scriptProperties[$v])) {
		$tmp = $modx->fromJSON($scriptProperties[$v]);
		if (is_array($tmp)) {
			$$v = array_merge($$v, $tmp);
		}
	}
	unset($scriptProperties[$v]);
}

// Default parameters
$default = array(
	\'class\' => $class,
	//,\'where\' => $modx->toJSON($where),
	\'leftJoin\' => $modx->toJSON($leftJoin),
	\'select\' => $modx->toJSON($select),
	\'groupby\' => $class.\'.id\',
	\'fastMode\' => $fastMode,
	\'return\' => !empty($returnIds)
			? \'ids\'
			: \'data\',
	\'nestedChunkPrefix\' => \'msearch2_\',
);
if (!empty($resources)) {
	$default[\'resources\'] = is_array($resources)
		? implode(\',\', $resources)
		: $resources;
}

// Merge all properties and run!
$pdoFetch->setConfig(array_merge($default, $scriptProperties), false);
$pdoFetch->addTime(\'Query parameters are prepared.\');
$rows = $pdoFetch->run();

// Processing results
if ($returnIds) {
	return $rows;
}
elseif (!empty($rows) && is_array($rows)) {
	$output = array();
	foreach ($rows as $k => $row) {
		// Processing main fields
		$row[\'weight\'] = isset($found[$row[\'id\']]) ? $found[$row[\'id\']] : \'\';
		$row[\'intro\'] = $mSearch2->Highlight($row[\'intro\'], $query, $htagOpen, $htagClose);

		$row[\'idx\'] = $pdoFetch->idx++;
		$tplRow = $pdoFetch->defineChunk($row);
		$output[] .= empty($tplRow)
			? $pdoFetch->getChunk(\'\', $row)
			: $pdoFetch->getChunk($tplRow, $row, $fastMode);
	}
	$pdoFetch->addTime(\'Returning processed chunks\');
	if (!empty($output)) {
		$output = implode($outputSeparator, $output);
	}
}
else {
	$output = $modx->lexicon(\'mse2_err_no_results\');
}

if ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {
	$output .= \'<pre class="mSearchLog">\' . print_r($pdoFetch->getTime(), 1) . \'</pre>\';
}

// Return output
if (!empty($tplWrapper) && (!empty($wrapIfEmpty) || !empty($output))) {
	$output = $pdoFetch->getChunk(
		$tplWrapper,
		array(
			\'output\' => $output,
			\'total\' => $modx->getPlaceholder($pdoFetch->config[\'totalVar\']),
			\'query\' => $modx->getPlaceholder($plPrefix.$queryVar),
			\'parents\' => $modx->getPlaceholder($plPrefix.$parentsVar),
		),
		$fastMode
	);
}

if (!empty($toPlaceholder)) {
	$modx->setPlaceholder($toPlaceholder, $output);
}
else {
	return $output;
}',
    ),
  ),
  'b7933e46566dc381567c8a73c19dc75f' => 
  array (
    'criteria' => 
    array (
      'name' => 'mSearchForm',
    ),
    'object' => 
    array (
      'id' => 24,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'mSearchForm',
      'description' => '',
      'editor_type' => 0,
      'category' => 13,
      'cache_type' => 0,
      'snippet' => '/** @var array $scriptProperties */
/** @var pdoTools $pdoTools */
$fqn = $modx->getOption(\'pdoTools.class\', null, \'pdotools.pdofetch\', true);
if (!$pdoClass = $modx->loadClass($fqn, \'\', false, true)) {return false;}
$pdoTools = new $pdoClass($modx, $scriptProperties);
$pdoTools->addTime(\'pdoTools loaded.\');

/** @var mSearch2 $mSearch2 */
if (!$modx->loadClass(\'msearch2\', MODX_CORE_PATH . \'components/msearch2/model/msearch2/\', false, true)) {return false;}
$mSearch2 = new mSearch2($modx, array(), $pdoFetch);
$mSearch2->initialize($modx->context->key);

$config = array(
	\'autocomplete\' => !empty($autocomplete) ? $autocomplete : \'results\',
	\'queryVar\' => !empty($queryVar) ? $queryVar : \'query\',
	\'minQuery\' => !empty($minQuery) ? (integer) $minQuery : 3,
	\'pageId\' => !empty($pageId) ? (integer) $pageId : $modx->resource->id,
);
$scriptProperties = array_merge($scriptProperties, $config);

if (empty($tplForm)) {$tplForm = \'tpl.mSearch2.form\';}
$form = $pdoTools->getChunk($tplForm, $scriptProperties);

$hash = sha1(serialize($scriptProperties));
$_SESSION[\'mSearch2\'][$hash] = $scriptProperties;

$form = str_ireplace(\'<form\', \'<form data-key="\'.$hash.\'"\', $form);
// Place for enabled log
if ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {
	$form = str_ireplace(\'</form>\', "</form>\\n<pre class=\\"mSearchFormLog\\"></pre>", $form);
}

// Setting values for frontend javascript
$main_config = array(
	\'cssUrl\' => $mSearch2->config[\'cssUrl\'].\'web/\',
	\'jsUrl\' => $mSearch2->config[\'jsUrl\'].\'web/\',
	\'actionUrl\' => $mSearch2->config[\'actionUrl\'],
);

$modx->regClientStartupScript(\'
<script type="text/javascript">
if (typeof mse2Config == "undefined") {mse2Config = \'.$modx->toJSON($main_config).\';}
if (typeof mse2FormConfig == "undefined") {mse2FormConfig = {};}
mse2FormConfig["\'.$hash.\'"] = \'.$modx->toJSON($config).\';
</script>\'
, true);

return $form;',
      'locked' => 0,
      'properties' => 'a:10:{s:6:"pageId";a:7:{s:4:"name";s:6:"pageId";s:4:"desc";s:16:"mse2_prop_pageId";s:4:"type";s:11:"numberfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:7:"tplForm";a:7:{s:4:"name";s:7:"tplForm";s:4:"desc";s:17:"mse2_prop_tplForm";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:17:"tpl.mSearch2.form";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:3:"tpl";a:7:{s:4:"name";s:3:"tpl";s:4:"desc";s:13:"mse2_prop_tpl";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:15:"tpl.mSearch2.ac";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:7:"element";a:7:{s:4:"name";s:7:"element";s:4:"desc";s:17:"mse2_prop_element";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:8:"mSearch2";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:5:"limit";a:7:{s:4:"name";s:5:"limit";s:4:"desc";s:15:"mse2_prop_limit";s:4:"type";s:11:"numberfield";s:7:"options";a:0:{}s:5:"value";i:5;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:12:"autocomplete";a:7:{s:4:"name";s:12:"autocomplete";s:4:"desc";s:22:"mse2_prop_autocomplete";s:4:"type";s:4:"list";s:7:"options";a:3:{i:0;a:2:{s:4:"text";s:8:"Disabled";s:5:"value";i:0;}i:1;a:2:{s:4:"text";s:7:"Results";s:5:"value";s:7:"results";}i:2;a:2:{s:4:"text";s:7:"Queries";s:5:"value";s:7:"queries";}}s:5:"value";s:7:"results";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:8:"queryVar";a:7:{s:4:"name";s:8:"queryVar";s:4:"desc";s:18:"mse2_prop_queryVar";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:5:"query";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:8:"minQuery";a:7:{s:4:"name";s:8:"minQuery";s:4:"desc";s:18:"mse2_prop_minQuery";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";i:3;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:6:"fields";a:7:{s:4:"name";s:6:"fields";s:4:"desc";s:16:"mse2_prop_fields";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:9:"onlyIndex";a:7:{s:4:"name";s:9:"onlyIndex";s:4:"desc";s:19:"mse2_prop_onlyIndex";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}}',
      'moduleguid' => '',
      'static' => 0,
      'static_file' => 'core/components/msearch2/elements/snippets/snippet.msearchform.php',
      'content' => '/** @var array $scriptProperties */
/** @var pdoTools $pdoTools */
$fqn = $modx->getOption(\'pdoTools.class\', null, \'pdotools.pdofetch\', true);
if (!$pdoClass = $modx->loadClass($fqn, \'\', false, true)) {return false;}
$pdoTools = new $pdoClass($modx, $scriptProperties);
$pdoTools->addTime(\'pdoTools loaded.\');

/** @var mSearch2 $mSearch2 */
if (!$modx->loadClass(\'msearch2\', MODX_CORE_PATH . \'components/msearch2/model/msearch2/\', false, true)) {return false;}
$mSearch2 = new mSearch2($modx, array(), $pdoFetch);
$mSearch2->initialize($modx->context->key);

$config = array(
	\'autocomplete\' => !empty($autocomplete) ? $autocomplete : \'results\',
	\'queryVar\' => !empty($queryVar) ? $queryVar : \'query\',
	\'minQuery\' => !empty($minQuery) ? (integer) $minQuery : 3,
	\'pageId\' => !empty($pageId) ? (integer) $pageId : $modx->resource->id,
);
$scriptProperties = array_merge($scriptProperties, $config);

if (empty($tplForm)) {$tplForm = \'tpl.mSearch2.form\';}
$form = $pdoTools->getChunk($tplForm, $scriptProperties);

$hash = sha1(serialize($scriptProperties));
$_SESSION[\'mSearch2\'][$hash] = $scriptProperties;

$form = str_ireplace(\'<form\', \'<form data-key="\'.$hash.\'"\', $form);
// Place for enabled log
if ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {
	$form = str_ireplace(\'</form>\', "</form>\\n<pre class=\\"mSearchFormLog\\"></pre>", $form);
}

// Setting values for frontend javascript
$main_config = array(
	\'cssUrl\' => $mSearch2->config[\'cssUrl\'].\'web/\',
	\'jsUrl\' => $mSearch2->config[\'jsUrl\'].\'web/\',
	\'actionUrl\' => $mSearch2->config[\'actionUrl\'],
);

$modx->regClientStartupScript(\'
<script type="text/javascript">
if (typeof mse2Config == "undefined") {mse2Config = \'.$modx->toJSON($main_config).\';}
if (typeof mse2FormConfig == "undefined") {mse2FormConfig = {};}
mse2FormConfig["\'.$hash.\'"] = \'.$modx->toJSON($config).\';
</script>\'
, true);

return $form;',
    ),
  ),
  '1f1c6f27277a3545842c038f705f7c15' => 
  array (
    'criteria' => 
    array (
      'name' => 'mFilter2',
    ),
    'object' => 
    array (
      'id' => 25,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'mFilter2',
      'description' => '',
      'editor_type' => 0,
      'category' => 13,
      'cache_type' => 0,
      'snippet' => '/** @var array $scriptProperties */
/** @var pdoFetch $pdoFetch */
$fqn = $modx->getOption(\'pdoFetch.class\', null, \'pdotools.pdofetch\', true);
if (!$pdoClass = $modx->loadClass($fqn, \'\', false, true)) {return false;}
$pdoFetch = new $pdoClass($modx, $scriptProperties);
$pdoFetch->addTime(\'pdoTools loaded.\');
/** @var mSearch2 $mSearch2 */
if (!$modx->loadClass(\'msearch2\', MODX_CORE_PATH . \'components/msearch2/model/msearch2/\', false, true)) {return false;}
$mSearch2 = new mSearch2($modx, $scriptProperties, $pdoFetch);
$mSearch2->initialize($modx->context->key);
$savedProperties = array();

if (empty($queryVar)) {$queryVar = \'query\';}
if (empty($parentsVar)) {$parentsVar = \'parents\';}
if (empty($minQuery)) {$minQuery = $modx->getOption(\'index_min_words_length\', null, 3, true);}
if (empty($classActive)) {$classActive = \'active\';}
if (isset($scriptProperties[\'disableSuggestions\'])) {$scriptProperties[\'suggestions\'] = empty($scriptProperties[\'disableSuggestions\']);}
if (empty($toPlaceholders) && !empty($toPlaceholder)) {$toPlaceholders = $toPlaceholder;}
if (empty($plPrefix)) {$plPrefix = \'mse2_\';}
if (isset($_REQUEST[\'limit\']) && is_numeric($_REQUEST[\'limit\']) && abs($_REQUEST[\'limit\']) > 0) {$limit = abs($_REQUEST[\'limit\']);}
elseif ($limit == \'\') {$limit = 10;}
if (!isset($outputSeparator)) {$outputSeparator = "\\n";}
$fastMode = !empty($fastMode);
// All templates of filters are converted to lowercase
foreach ($scriptProperties as $k => $v) {
	if (strpos($k, \'tplFilter\') === 0) {
		$tmp = \'tplFilter.\' . strtolower(substr($k, 10));
		if ($tmp != $k) {
			unset($scriptProperties[$k]);
			$scriptProperties[$tmp] = $v;
		}
	}
}

$class = \'modResource\';
$output = array(\'filters\' => \'\', \'results\' => \'\', \'total\' => 0, \'limit\' => $limit);
$ids = $found = $log = $where = array();

// ---------------------- Retrieving ids of resources for filter
$query = !empty($_REQUEST[$queryVar])
	? htmlspecialchars(strip_tags(trim($_REQUEST[$queryVar])))
	: \'\';

// Filter by ids
if (!empty($resources)) {
	$ids = array_map(\'trim\', explode(\',\', $resources));
}
elseif (isset($_REQUEST[$queryVar]) && empty($query)) {
	$output[\'results\'] =  $modx->lexicon(\'mse2_err_no_query\');
}
elseif (empty($query) && !empty($forceSearch)) {
	$output[\'results\'] = $modx->lexicon(\'mse2_err_no_query_var\');
}
elseif (isset($_REQUEST[$queryVar]) && !preg_match(\'/^[0-9]{2,}$/\', $query) && mb_strlen($query,\'UTF-8\') < $minQuery) {
	$output[\'results\'] = $modx->lexicon(\'mse2_err_min_query\');
}
elseif (isset($_REQUEST[$queryVar])) {
	$modx->setPlaceholder($plPrefix.$queryVar, $query);

	$found = $mSearch2->Search($query);
	$ids = array_keys($found);

	if (!empty($ids)) {
		$tmp = $scriptProperties;
		$tmp[\'returnIds\'] = 1;
		$tmp[\'resources\'] = implode(\',\', $ids);
		$tmp[\'parents\'] = (int) $scriptProperties[\'parents\'];
		$tmp[\'limit\'] = 0;
		$ids = explode(\',\', $modx->runSnippet($scriptProperties[\'element\'], $tmp));
		$pdoFetch->addTime(\'Found ids: "\'.implode(\',\',$ids).\'"\');
	}

	if (empty($ids[0])) {
		$output[\'results\'] = $modx->lexicon(\'mse2_err_no_results\');
	}
}

$modx->setPlaceholder($plPrefix.$queryVar, $query);

// Has error message - exit
if (!empty($output[\'results\'])) {
	$log = \'\';
	if ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {
		$log = \'<pre class="mFilterLog">\' . print_r($pdoFetch->getTime(), 1) . \'</pre>\';
	}
	if (!empty($toSeparatePlaceholders)) {
		$output[\'log\'] = $log;
		$modx->setPlaceholders($output, $toSeparatePlaceholders);
		return;
	}
	elseif (!empty($toPlaceholders)) {
		$output[\'log\'] = $log;
		$modx->setPlaceholders($output, $toPlaceholders);
		return;
	}
	else {
		$output = $pdoFetch->getChunk($scriptProperties[\'tplOuter\'], $output, $fastMode);
		$output .= $log;
		return $output;
	}
}

// ---------------------- Checking resources by status and custom "where" parameter
// Support for specifying property set in the element name
$elementName = $scriptProperties[\'element\'];
$elementSet = array();
if (strpos($elementName, \'@\') !== false) {
	list($elementName, $elementSet) = explode(\'@\', $elementName);
}
/** @var modSnippet $snippet */
if (!empty($elementName) && $element = $modx->getObject(\'modSnippet\', array(\'name\' => $elementName))) {
	$elementProperties = $element->getProperties();
	$elementPropertySet = !empty($elementSet)
		? $element->getPropertySet($elementSet)
		: array();
	if (!is_array($elementPropertySet)) {$elementPropertySet = array();}
	$params = array_merge(
		$elementProperties,
		$elementPropertySet,
		$scriptProperties,
		array(
			\'parents\' => empty($scriptProperties[$parentsVar]) && !empty($_REQUEST[$parentsVar])
				? $_REQUEST[$parentsVar]
				: $scriptProperties[$parentsVar],
			\'returnIds\' => 1,
			\'limit\' => 0,
		)
	);
	if (!empty($ids)) {
		$params[\'resources\'] = implode(\',\', $ids);
	}
	$element->setCacheable(false);
	$tmp = $element->process($params);
	if (!empty($tmp)) {
		$tmp = explode(\',\', $tmp);
		$ids = !empty($ids)
			? array_intersect($ids, $tmp)
			: $tmp;
	}
	$pdoFetch->addTime(\'Fetched ids for building filters: "\'.implode(\',\',$ids).\'" from element "\'.$elementName.\'"\');
}
else {
	$modx->log(modX::LOG_LEVEL_ERROR, \'[mSearch2] Could not find main snippet with name: "\'.$elementName.\'"\');
	return \'\';
}

// ---------------------- Nothing to filter, exit
if (empty($ids)) {
	if ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {
		$log = \'<pre class="mFilterLog">\' . print_r($pdoFetch->getTime(), 1) . \'</pre>\';
	}
	else {$log = \'\';}

	$output = array_merge($output, array(
		\'filters\' => $modx->lexicon(\'mse2_err_no_filters\')
		,\'results\' => $modx->lexicon(\'mse2_err_no_results\')
		,\'log\' => $log
	));

	if (!empty($toSeparatePlaceholders)) {
		$modx->setPlaceholders($output, $toSeparatePlaceholders);
		return;
	}
	elseif (!empty($toPlaceholders)) {
		$modx->setPlaceholders($output, $toPlaceholders);
		return;
	}
	else {
		$output[\'results\'] .= $log;
		return $pdoFetch->getChunk($scriptProperties[\'tplOuter\'], $output, $fastMode);
	}
}

// ---------------------- Checking for suggestions processing
// Checking by results count
if (!empty($scriptProperties[\'suggestionsMaxResults\']) && count($ids) > $scriptProperties[\'suggestionsMaxResults\']) {
	$scriptProperties[\'suggestions\'] = false;
	$pdoFetch->addTime(\'Suggestions disabled by "suggestionsMaxResults" parameter: results count is \'.count($ids).\', max allowed is \'.$scriptProperties[\'suggestionsMaxResults\']);
}
else {
	$pdoFetch->addTime(\'Total number of results: \'.count($ids));
}

// Then get filters
$pdoFetch->addTime(\'Getting filters for ids: "\'.implode(\',\',$ids).\'"\');
$filters = \'\'; $count = 0;
if (!empty($ids)) {
	$filters = $mSearch2->getFilters($ids);
	// And checking by filters count
	if (!empty($filters) && $scriptProperties[\'suggestions\']) {
		foreach ($filters as $tmp) {
			if (!is_array($tmp)) {continue;}
			$count += count(array_values($tmp));
		}
		if (!empty($scriptProperties[\'suggestionsMaxFilters\']) && $count > $scriptProperties[\'suggestionsMaxFilters\']) {
			$scriptProperties[\'suggestions\'] = false;
			$pdoFetch->addTime(\'Suggestions disabled by "suggestionsMaxFilters" parameter: filters count is \'.$count.\', max allowed is \'.$scriptProperties[\'suggestionsMaxFilters\']);
		}
		else {
			$pdoFetch->addTime(\'Total number of filters: \'.$count);
		}
	}
}
$modx->setPlaceholder($plPrefix . \'filters_count\', $count );


// ---------------------- Loading results
$start_sort = implode(\',\', array_map(\'trim\' , explode(\',\', $scriptProperties[\'sort\'])));
$start_limit = !empty($scriptProperties[\'limit\']) ? $scriptProperties[\'limit\'] : 0;
$suggestions = array();
$page = $sort = \'\';

// Support for specifying property set in the paginator name
$paginatorName = $scriptProperties[\'paginator\'];
$paginatorSet = array();
if (strpos($paginatorName, \'@\') !== false) {
	list($paginatorName, $paginatorSet) = explode(\'@\', $paginatorName);
}
if (!empty($ids)) {
	/* @var modSnippet $paginator */
	if ($paginator = $modx->getObject(\'modSnippet\', array(\'name\' => $paginatorName))) {
		$paginatorProperties = $paginator->getProperties();
		$paginatorPropertySet = !empty($paginatorSet)
			? $paginator->getPropertySet($paginatorSet)
			: array();
		if (!is_array($paginatorPropertySet)) {$paginatorPropertySet = array();}
		$paginatorProperties = array_merge(
			$paginatorProperties
			,$paginatorPropertySet
			,$elementPropertySet
			,$scriptProperties
			,array(
				\'resources\' => implode(\',\',$ids)
				,\'parents\' => \'0\'
				,\'element\' => $elementName
				,\'defaultSort\' => $start_sort
				,\'toPlaceholder\' => false
				,\'limit\' => $limit
			)
		);

		// Switching chunk for rows, if specified
		if (!empty($scriptProperties[\'tpls\'])) {
			$tmp = isset($_REQUEST[\'tpl\']) ? (integer) $_REQUEST[\'tpl\'] : 0;
			$tpls = array_map(\'trim\', explode(\',\', $scriptProperties[\'tpls\']));
			$paginatorProperties[\'tpls\'] = $tpls;
			if (isset($tpls[$tmp])) {
				$paginatorProperties[\'tpl\'] = $tpls[$tmp];
				$paginatorProperties[\'tpl_idx\'] = $tmp;
			}
		}

		// Trying to save weight of found ids if using mSearch2
		$weight = false;
		if (!empty($found) && strtolower($paginatorName) == \'msearch2\') {
			$tmp = array();
			foreach ($ids as $v) {
				$tmp[$v] = isset($found[$v])
					? $found[$v]
					: 0;
			}
			$paginatorProperties[\'resources\'] = $modx->toJSON($tmp);
			$weight = true;
		}

		if (!empty($_REQUEST[\'sort\'])) {$sort = $_REQUEST[\'sort\'];}
		elseif (!empty($start_sort)) {$sort = $start_sort;}
		else {
			/*
			$sortby = !empty($scriptProperties[\'sortby\']) ? $scriptProperties[\'sortby\'] : \'\';
			if (!empty($sortby)) {
				$sortdir = !empty($scriptProperties[\'sortdir\']) ? $scriptProperties[\'sortdir\'] : \'asc\';
				$sort = $sortby.$mSearch2->config[\'method_delimeter\'].$sortdir;
			}
			*/
		}

		if (!empty($_REQUEST[$paginatorProperties[\'pageVarKey\']])) {
			$page = (int) $_REQUEST[$paginatorProperties[\'pageVarKey\']];
		}
		if (!empty($sort)) {
			$paginatorProperties[\'sortby\'] = $mSearch2->getSortFields($sort);
			$paginatorProperties[\'sortdir\'] = \'\';
		}

		$paginatorProperties[\'start_limit\'] = $start_limit;
		$savedProperties[\'paginatorProperties\'] = $paginatorProperties;

		// We have a delimeters in $_GET, so need to filter resources
		if (strpos(implode(array_keys($_GET)), $mSearch2->config[\'filter_delimeter\']) !== false) {
			$matched = $mSearch2->Filter($ids, $_REQUEST);
			$matched = array_intersect($ids, $matched);
			if ($scriptProperties[\'suggestions\']) {
				$suggestions = $mSearch2->getSuggestions($ids, $_REQUEST, $matched);
				$pdoFetch->addTime(\'Suggestions retrieved.\');
			}
			// Trying to save weight of found ids again
			if ($weight) {
				$tmp = array();
				foreach ($matched as $v) {$tmp[$v] = isset($found[$v]) ? $found[$v] : 0;}
				$paginatorProperties[\'resources\'] = $modx->toJSON($tmp);
			}
			else {
				$paginatorProperties[\'resources\'] = implode(\',\', $matched);
			}
		}
		// Saving log
		$log = $pdoFetch->timings;
		$pdoFetch->timings = array();

		//$paginator->setProperties($paginatorProperties);
		$paginator->setCacheable(false);
		$output[\'results\'] = !empty($paginatorProperties[\'resources\'])
			? $paginator->process($paginatorProperties)
			: $modx->lexicon(\'mse2_err_no_results\');
		$output[\'total\'] = $modx->getPlaceholder($paginatorProperties[\'totalVar\']);
	}
	else {
		$modx->log(modX::LOG_LEVEL_ERROR, \'[mSearch2] Could not find pagination snippet with name: "\'.$paginatorName.\'"\');
		return \'\';
	}
}

// ----------------------  Loading filters
$pdoFetch->timings = $log;
if (!empty($paginator)) {
	$pdoFetch->addTime(\'Fired paginator: "\'.$paginatorName.\'"\');
}
else {
	$pdoFetch->addTime(\'Could not find pagination snippet with name: "\'.$paginatorName.\'"\');
}
if (empty($filters)) {
	$pdoFetch->addTime(\'No filters retrieved\');
	$output[\'filters\'] = $modx->lexicon(\'mse2_err_no_filters\');
	if (empty($output[\'results\'])) {$output[\'results\'] = $modx->lexicon(\'mse2_err_no_results\');}
}
else {
	$pdoFetch->addTime(\'Filters retrieved\');
	$request = array();
	foreach ($_GET as $k => $v) {
		$request[$k] = explode($mSearch2->config[\'values_delimeter\'], $v);
	}

	foreach ($filters as $filter => $data) {
		if (empty($data) || !is_array($data)) {continue;}
		$tplOuter = !empty($scriptProperties[\'tplFilter.outer.\'.$filter]) ? $scriptProperties[\'tplFilter.outer.\'.$filter] : $scriptProperties[\'tplFilter.outer.default\'];
		$tplRow = !empty($scriptProperties[\'tplFilter.row.\'.$filter]) ? $scriptProperties[\'tplFilter.row.\'.$filter] : $scriptProperties[\'tplFilter.row.default\'];
		$tplEmpty = !empty($scriptProperties[\'tplFilter.empty.\'.$filter]) ? $scriptProperties[\'tplFilter.empty.\'.$filter] : \'\';

		// Caching chunk for quick placeholders
		$pdoFetch->getChunk($tplRow);

		$rows = $has_active = \'\';
		list($table,$filter2) = explode($mSearch2->config[\'filter_delimeter\'], $filter);
		$idx = 0;
		foreach ($data as $v) {
			if (empty($v)) {continue;}
			$checked = isset($request[$filter]) && in_array($v[\'value\'], $request[$filter]) && isset($v[\'type\']) && $v[\'type\'] != \'number\';
			if ($scriptProperties[\'suggestions\']) {
				if ($checked) {$num = \'\'; $has_active = \'has_active\';}
				else if (isset($suggestions[$filter][$v[\'value\']])) {
					$num = $suggestions[$filter][$v[\'value\']];
				}
				else {
					$num = !empty($v[\'resources\']) ? count($v[\'resources\']) : \'\';
				}
			} else {$num = \'\';}

			$rows .= $pdoFetch->getChunk($tplRow, array(
				\'filter\' => $filter2
				,\'table\' => $table
				,\'title\' => $v[\'title\']
				,\'value\' => $v[\'value\']
				,\'type\' => $v[\'type\']
				,\'checked\' => $checked ? \'checked\' : \'\'
				,\'selected\' => $checked ? \'selected\' : \'\'
				,\'disabled\' => !$checked && empty($num) && $scriptProperties[\'suggestions\'] ? \'disabled\' : \'\'
				,\'delimeter\' => $mSearch2->config[\'filter_delimeter\']
				,\'idx\' => $idx++
				,\'num\' => $num
			), $fastMode);
		}

		$tpl = empty($rows) ? $tplEmpty : $tplOuter;
		if (!isset($output[\'filters\'][$filter])) {$output[\'filters\'][$filter] = \'\';}
		$output[\'filters\'][$filter] .= $pdoFetch->getChunk($tpl, array(
			\'filter\' => $filter2
			,\'table\' => $table
			,\'rows\' => $rows
			,\'has_active\' => $has_active
			,\'delimeter\' => $mSearch2->config[\'filter_delimeter\']
		), $fastMode);
	}

	if (empty($output[\'filters\'])) {
		$output[\'filters\'] = $modx->lexicon(\'mse2_err_no_filters\');
		if (empty($output[\'results\'])) {$output[\'results\'] = $modx->lexicon(\'mse2_err_no_results\');}
	}
	else {
		$pdoFetch->addTime(\'Filters templated\');
	}
}
$pdoFetch->addTime(\'Total filter operations: \'.$mSearch2->filter_operations);

// Saving params into cache for ajax requests
$savedProperties[\'scriptProperties\'] = $scriptProperties;
$hash = sha1(serialize($savedProperties));
$_SESSION[\'mSearch2\'][$hash] = $savedProperties;

// Active class for sort links
if (!empty($sort)) {$output[$sort] = $classActive;}
if (isset($paginatorProperties[\'tpl_idx\'])) {
	$output[\'tpl\'.$paginatorProperties[\'tpl_idx\']] = $classActive;
	$output[\'tpls\'] = 1;
}

// Setting values for frontend javascript
$config = array(
	\'cssUrl\' => $mSearch2->config[\'cssUrl\'].\'web/\',
	\'jsUrl\' => $mSearch2->config[\'jsUrl\'].\'web/\',
	\'actionUrl\' => $mSearch2->config[\'actionUrl\'],
	\'queryVar\' => $mSearch2->config[\'queryVar\'],
	\'filter_delimeter\' => $mSearch2->config[\'filter_delimeter\'],
	\'method_delimeter\' => $mSearch2->config[\'method_delimeter\'],
	\'values_delimeter\' => $mSearch2->config[\'values_delimeter\'],
	\'start_sort\' => $start_sort,
	\'start_limit\' => $start_limit,
	\'start_page\' => 1,
	\'start_tpl\' => \'\',
	\'sort\' => $sort == $start_sort ? \'\' : $sort,
	\'limit\' => $limit == $start_limit ? \'\' : $limit,
	\'page\' => $page,
	\'tpl\' => !empty($paginatorProperties[\'tpl_idx\'])
			? $paginatorProperties[\'tpl_idx\']
			: \'\',
	\'parentsVar\' => $parentsVar,
	\'key\' => $hash,
	\'pageId\' => !empty($pageId) ? (integer) $pageId : $modx->resource->id,
	$queryVar => isset($_REQUEST[$queryVar]) ? $_REQUEST[$queryVar] : \'\',
	$parentsVar => isset($_REQUEST[$parentsVar]) ? $_REQUEST[$parentsVar] : \'\',
);

$modx->regClientStartupScript(\'
<script type="text/javascript">
mse2Config = \'.$modx->toJSON($config).\';
</script>\', true);
$modx->setPlaceholders($config, $plPrefix);

// Prepare output
$log = \'\';
if ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {
	$log = \'<pre class="mFilterLog">\' . print_r($pdoFetch->getTime(), 1) . \'</pre>\';
}

if (!empty($toSeparatePlaceholders)) {
	$modx->setPlaceholders($output[\'filters\'], $toSeparatePlaceholders);
	$output[\'log\'] = $log;
	if (is_array($output[\'filters\'])) {
		$output[\'filters\'] = implode($outputSeparator, $output[\'filters\']);
	}

	if (empty($output[\'results\'])) {
		$pcre = \'/^\' . preg_quote($toSeparatePlaceholders) .\'(\\d+)$/\';
		foreach ($modx->placeholders as $k => $v) {
			if (preg_match($pcre, $k)) {
				$output[\'results\'][] = $v;
			}
		}
		$output[\'results\'] = implode($outputSeparator, $output[\'results\']);
	}

	$modx->setPlaceholders($output, $toSeparatePlaceholders);
}
else {
	if (is_array($output[\'filters\'])) {
		$output[\'filters\'] = implode($outputSeparator, $output[\'filters\']);
	}
	if (!empty($toPlaceholders)) {
		$output[\'log\'] = $log;
		$modx->setPlaceholders($output, $toPlaceholders);
	}
	else {
		$output = $pdoFetch->getChunk($scriptProperties[\'tplOuter\'], $output, $fastMode);
		$output .= $log;

		return $output;
	}
}',
      'locked' => 0,
      'properties' => 'a:30:{s:9:"paginator";a:7:{s:4:"name";s:9:"paginator";s:4:"desc";s:19:"mse2_prop_paginator";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:7:"pdoPage";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:7:"element";a:7:{s:4:"name";s:7:"element";s:4:"desc";s:17:"mse2_prop_element";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:8:"mSearch2";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:4:"sort";a:7:{s:4:"name";s:4:"sort";s:4:"desc";s:14:"mse2_prop_sort";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:7:"filters";a:7:{s:4:"name";s:7:"filters";s:4:"desc";s:17:"mse2_prop_filters";s:4:"type";s:8:"textarea";s:7:"options";a:0:{}s:5:"value";s:23:"resource|parent:parents";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:16:"showEmptyFilters";a:7:{s:4:"name";s:16:"showEmptyFilters";s:4:"desc";s:26:"mse2_prop_showEmptyFilters";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:9:"resources";a:7:{s:4:"name";s:9:"resources";s:4:"desc";s:19:"mse2_prop_resources";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:7:"parents";a:7:{s:4:"name";s:7:"parents";s:4:"desc";s:17:"mse2_prop_parents";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:5:"depth";a:7:{s:4:"name";s:5:"depth";s:4:"desc";s:15:"mse2_prop_depth";s:4:"type";s:11:"numberfield";s:7:"options";a:0:{}s:5:"value";i:10;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:8:"tplOuter";a:7:{s:4:"name";s:8:"tplOuter";s:4:"desc";s:18:"mse2_prop_tplOuter";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:18:"tpl.mFilter2.outer";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:23:"tplFilter.outer.default";a:7:{s:4:"name";s:23:"tplFilter.outer.default";s:4:"desc";s:33:"mse2_prop_tplFilter.outer.default";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:25:"tpl.mFilter2.filter.outer";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:21:"tplFilter.row.default";a:7:{s:4:"name";s:21:"tplFilter.row.default";s:4:"desc";s:31:"mse2_prop_tplFilter.row.default";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:28:"tpl.mFilter2.filter.checkbox";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:10:"showHidden";a:7:{s:4:"name";s:10:"showHidden";s:4:"desc";s:20:"mse2_prop_showHidden";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:11:"showDeleted";a:7:{s:4:"name";s:11:"showDeleted";s:4:"desc";s:21:"mse2_prop_showDeleted";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:15:"showUnpublished";a:7:{s:4:"name";s:15:"showUnpublished";s:4:"desc";s:25:"mse2_prop_showUnpublished";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:14:"hideContainers";a:7:{s:4:"name";s:14:"hideContainers";s:4:"desc";s:24:"mse2_prop_hideContainers";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:7:"showLog";a:7:{s:4:"name";s:7:"showLog";s:4:"desc";s:17:"mse2_prop_showLog";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:8:"fastMode";a:7:{s:4:"name";s:8:"fastMode";s:4:"desc";s:18:"mse2_prop_fastMode";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:11:"suggestions";a:7:{s:4:"name";s:11:"suggestions";s:4:"desc";s:21:"mse2_prop_suggestions";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:1;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:21:"suggestionsMaxFilters";a:7:{s:4:"name";s:21:"suggestionsMaxFilters";s:4:"desc";s:31:"mse2_prop_suggestionsMaxFilters";s:4:"type";s:11:"numberfield";s:7:"options";a:0:{}s:5:"value";i:200;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:21:"suggestionsMaxResults";a:7:{s:4:"name";s:21:"suggestionsMaxResults";s:4:"desc";s:31:"mse2_prop_suggestionsMaxResults";s:4:"type";s:11:"numberfield";s:7:"options";a:0:{}s:5:"value";i:1000;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:16:"suggestionsRadio";a:7:{s:4:"name";s:16:"suggestionsRadio";s:4:"desc";s:26:"mse2_prop_suggestionsRadio";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:14:"toPlaceholders";a:7:{s:4:"name";s:14:"toPlaceholders";s:4:"desc";s:24:"mse2_prop_toPlaceholders";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:22:"toSeparatePlaceholders";a:7:{s:4:"name";s:22:"toSeparatePlaceholders";s:4:"desc";s:32:"mse2_prop_toSeparatePlaceholders";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:16:"filter_delimeter";a:7:{s:4:"name";s:16:"filter_delimeter";s:4:"desc";s:26:"mse2_prop_filter_delimeter";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:1:"|";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:16:"method_delimeter";a:7:{s:4:"name";s:16:"method_delimeter";s:4:"desc";s:26:"mse2_prop_method_delimeter";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:1:":";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:16:"values_delimeter";a:7:{s:4:"name";s:16:"values_delimeter";s:4:"desc";s:26:"mse2_prop_values_delimeter";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:1:",";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:4:"tpls";a:7:{s:4:"name";s:4:"tpls";s:4:"desc";s:14:"mse2_prop_tpls";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:11:"forceSearch";a:7:{s:4:"name";s:11:"forceSearch";s:4:"desc";s:21:"mse2_prop_forceSearch";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:6:"fields";a:7:{s:4:"name";s:6:"fields";s:4:"desc";s:16:"mse2_prop_fields";s:4:"type";s:9:"textfield";s:7:"options";a:0:{}s:5:"value";s:0:"";s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}s:9:"onlyIndex";a:7:{s:4:"name";s:9:"onlyIndex";s:4:"desc";s:19:"mse2_prop_onlyIndex";s:4:"type";s:13:"combo-boolean";s:7:"options";a:0:{}s:5:"value";b:0;s:7:"lexicon";s:19:"msearch2:properties";s:4:"area";s:0:"";}}',
      'moduleguid' => '',
      'static' => 0,
      'static_file' => 'core/components/msearch2/elements/snippets/snippet.mfilter2.php',
      'content' => '/** @var array $scriptProperties */
/** @var pdoFetch $pdoFetch */
$fqn = $modx->getOption(\'pdoFetch.class\', null, \'pdotools.pdofetch\', true);
if (!$pdoClass = $modx->loadClass($fqn, \'\', false, true)) {return false;}
$pdoFetch = new $pdoClass($modx, $scriptProperties);
$pdoFetch->addTime(\'pdoTools loaded.\');
/** @var mSearch2 $mSearch2 */
if (!$modx->loadClass(\'msearch2\', MODX_CORE_PATH . \'components/msearch2/model/msearch2/\', false, true)) {return false;}
$mSearch2 = new mSearch2($modx, $scriptProperties, $pdoFetch);
$mSearch2->initialize($modx->context->key);
$savedProperties = array();

if (empty($queryVar)) {$queryVar = \'query\';}
if (empty($parentsVar)) {$parentsVar = \'parents\';}
if (empty($minQuery)) {$minQuery = $modx->getOption(\'index_min_words_length\', null, 3, true);}
if (empty($classActive)) {$classActive = \'active\';}
if (isset($scriptProperties[\'disableSuggestions\'])) {$scriptProperties[\'suggestions\'] = empty($scriptProperties[\'disableSuggestions\']);}
if (empty($toPlaceholders) && !empty($toPlaceholder)) {$toPlaceholders = $toPlaceholder;}
if (empty($plPrefix)) {$plPrefix = \'mse2_\';}
if (isset($_REQUEST[\'limit\']) && is_numeric($_REQUEST[\'limit\']) && abs($_REQUEST[\'limit\']) > 0) {$limit = abs($_REQUEST[\'limit\']);}
elseif ($limit == \'\') {$limit = 10;}
if (!isset($outputSeparator)) {$outputSeparator = "\\n";}
$fastMode = !empty($fastMode);
// All templates of filters are converted to lowercase
foreach ($scriptProperties as $k => $v) {
	if (strpos($k, \'tplFilter\') === 0) {
		$tmp = \'tplFilter.\' . strtolower(substr($k, 10));
		if ($tmp != $k) {
			unset($scriptProperties[$k]);
			$scriptProperties[$tmp] = $v;
		}
	}
}

$class = \'modResource\';
$output = array(\'filters\' => \'\', \'results\' => \'\', \'total\' => 0, \'limit\' => $limit);
$ids = $found = $log = $where = array();

// ---------------------- Retrieving ids of resources for filter
$query = !empty($_REQUEST[$queryVar])
	? htmlspecialchars(strip_tags(trim($_REQUEST[$queryVar])))
	: \'\';

// Filter by ids
if (!empty($resources)) {
	$ids = array_map(\'trim\', explode(\',\', $resources));
}
elseif (isset($_REQUEST[$queryVar]) && empty($query)) {
	$output[\'results\'] =  $modx->lexicon(\'mse2_err_no_query\');
}
elseif (empty($query) && !empty($forceSearch)) {
	$output[\'results\'] = $modx->lexicon(\'mse2_err_no_query_var\');
}
elseif (isset($_REQUEST[$queryVar]) && !preg_match(\'/^[0-9]{2,}$/\', $query) && mb_strlen($query,\'UTF-8\') < $minQuery) {
	$output[\'results\'] = $modx->lexicon(\'mse2_err_min_query\');
}
elseif (isset($_REQUEST[$queryVar])) {
	$modx->setPlaceholder($plPrefix.$queryVar, $query);

	$found = $mSearch2->Search($query);
	$ids = array_keys($found);

	if (!empty($ids)) {
		$tmp = $scriptProperties;
		$tmp[\'returnIds\'] = 1;
		$tmp[\'resources\'] = implode(\',\', $ids);
		$tmp[\'parents\'] = (int) $scriptProperties[\'parents\'];
		$tmp[\'limit\'] = 0;
		$ids = explode(\',\', $modx->runSnippet($scriptProperties[\'element\'], $tmp));
		$pdoFetch->addTime(\'Found ids: "\'.implode(\',\',$ids).\'"\');
	}

	if (empty($ids[0])) {
		$output[\'results\'] = $modx->lexicon(\'mse2_err_no_results\');
	}
}

$modx->setPlaceholder($plPrefix.$queryVar, $query);

// Has error message - exit
if (!empty($output[\'results\'])) {
	$log = \'\';
	if ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {
		$log = \'<pre class="mFilterLog">\' . print_r($pdoFetch->getTime(), 1) . \'</pre>\';
	}
	if (!empty($toSeparatePlaceholders)) {
		$output[\'log\'] = $log;
		$modx->setPlaceholders($output, $toSeparatePlaceholders);
		return;
	}
	elseif (!empty($toPlaceholders)) {
		$output[\'log\'] = $log;
		$modx->setPlaceholders($output, $toPlaceholders);
		return;
	}
	else {
		$output = $pdoFetch->getChunk($scriptProperties[\'tplOuter\'], $output, $fastMode);
		$output .= $log;
		return $output;
	}
}

// ---------------------- Checking resources by status and custom "where" parameter
// Support for specifying property set in the element name
$elementName = $scriptProperties[\'element\'];
$elementSet = array();
if (strpos($elementName, \'@\') !== false) {
	list($elementName, $elementSet) = explode(\'@\', $elementName);
}
/** @var modSnippet $snippet */
if (!empty($elementName) && $element = $modx->getObject(\'modSnippet\', array(\'name\' => $elementName))) {
	$elementProperties = $element->getProperties();
	$elementPropertySet = !empty($elementSet)
		? $element->getPropertySet($elementSet)
		: array();
	if (!is_array($elementPropertySet)) {$elementPropertySet = array();}
	$params = array_merge(
		$elementProperties,
		$elementPropertySet,
		$scriptProperties,
		array(
			\'parents\' => empty($scriptProperties[$parentsVar]) && !empty($_REQUEST[$parentsVar])
				? $_REQUEST[$parentsVar]
				: $scriptProperties[$parentsVar],
			\'returnIds\' => 1,
			\'limit\' => 0,
		)
	);
	if (!empty($ids)) {
		$params[\'resources\'] = implode(\',\', $ids);
	}
	$element->setCacheable(false);
	$tmp = $element->process($params);
	if (!empty($tmp)) {
		$tmp = explode(\',\', $tmp);
		$ids = !empty($ids)
			? array_intersect($ids, $tmp)
			: $tmp;
	}
	$pdoFetch->addTime(\'Fetched ids for building filters: "\'.implode(\',\',$ids).\'" from element "\'.$elementName.\'"\');
}
else {
	$modx->log(modX::LOG_LEVEL_ERROR, \'[mSearch2] Could not find main snippet with name: "\'.$elementName.\'"\');
	return \'\';
}

// ---------------------- Nothing to filter, exit
if (empty($ids)) {
	if ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {
		$log = \'<pre class="mFilterLog">\' . print_r($pdoFetch->getTime(), 1) . \'</pre>\';
	}
	else {$log = \'\';}

	$output = array_merge($output, array(
		\'filters\' => $modx->lexicon(\'mse2_err_no_filters\')
		,\'results\' => $modx->lexicon(\'mse2_err_no_results\')
		,\'log\' => $log
	));

	if (!empty($toSeparatePlaceholders)) {
		$modx->setPlaceholders($output, $toSeparatePlaceholders);
		return;
	}
	elseif (!empty($toPlaceholders)) {
		$modx->setPlaceholders($output, $toPlaceholders);
		return;
	}
	else {
		$output[\'results\'] .= $log;
		return $pdoFetch->getChunk($scriptProperties[\'tplOuter\'], $output, $fastMode);
	}
}

// ---------------------- Checking for suggestions processing
// Checking by results count
if (!empty($scriptProperties[\'suggestionsMaxResults\']) && count($ids) > $scriptProperties[\'suggestionsMaxResults\']) {
	$scriptProperties[\'suggestions\'] = false;
	$pdoFetch->addTime(\'Suggestions disabled by "suggestionsMaxResults" parameter: results count is \'.count($ids).\', max allowed is \'.$scriptProperties[\'suggestionsMaxResults\']);
}
else {
	$pdoFetch->addTime(\'Total number of results: \'.count($ids));
}

// Then get filters
$pdoFetch->addTime(\'Getting filters for ids: "\'.implode(\',\',$ids).\'"\');
$filters = \'\'; $count = 0;
if (!empty($ids)) {
	$filters = $mSearch2->getFilters($ids);
	// And checking by filters count
	if (!empty($filters) && $scriptProperties[\'suggestions\']) {
		foreach ($filters as $tmp) {
			if (!is_array($tmp)) {continue;}
			$count += count(array_values($tmp));
		}
		if (!empty($scriptProperties[\'suggestionsMaxFilters\']) && $count > $scriptProperties[\'suggestionsMaxFilters\']) {
			$scriptProperties[\'suggestions\'] = false;
			$pdoFetch->addTime(\'Suggestions disabled by "suggestionsMaxFilters" parameter: filters count is \'.$count.\', max allowed is \'.$scriptProperties[\'suggestionsMaxFilters\']);
		}
		else {
			$pdoFetch->addTime(\'Total number of filters: \'.$count);
		}
	}
}
$modx->setPlaceholder($plPrefix . \'filters_count\', $count );


// ---------------------- Loading results
$start_sort = implode(\',\', array_map(\'trim\' , explode(\',\', $scriptProperties[\'sort\'])));
$start_limit = !empty($scriptProperties[\'limit\']) ? $scriptProperties[\'limit\'] : 0;
$suggestions = array();
$page = $sort = \'\';

// Support for specifying property set in the paginator name
$paginatorName = $scriptProperties[\'paginator\'];
$paginatorSet = array();
if (strpos($paginatorName, \'@\') !== false) {
	list($paginatorName, $paginatorSet) = explode(\'@\', $paginatorName);
}
if (!empty($ids)) {
	/* @var modSnippet $paginator */
	if ($paginator = $modx->getObject(\'modSnippet\', array(\'name\' => $paginatorName))) {
		$paginatorProperties = $paginator->getProperties();
		$paginatorPropertySet = !empty($paginatorSet)
			? $paginator->getPropertySet($paginatorSet)
			: array();
		if (!is_array($paginatorPropertySet)) {$paginatorPropertySet = array();}
		$paginatorProperties = array_merge(
			$paginatorProperties
			,$paginatorPropertySet
			,$elementPropertySet
			,$scriptProperties
			,array(
				\'resources\' => implode(\',\',$ids)
				,\'parents\' => \'0\'
				,\'element\' => $elementName
				,\'defaultSort\' => $start_sort
				,\'toPlaceholder\' => false
				,\'limit\' => $limit
			)
		);

		// Switching chunk for rows, if specified
		if (!empty($scriptProperties[\'tpls\'])) {
			$tmp = isset($_REQUEST[\'tpl\']) ? (integer) $_REQUEST[\'tpl\'] : 0;
			$tpls = array_map(\'trim\', explode(\',\', $scriptProperties[\'tpls\']));
			$paginatorProperties[\'tpls\'] = $tpls;
			if (isset($tpls[$tmp])) {
				$paginatorProperties[\'tpl\'] = $tpls[$tmp];
				$paginatorProperties[\'tpl_idx\'] = $tmp;
			}
		}

		// Trying to save weight of found ids if using mSearch2
		$weight = false;
		if (!empty($found) && strtolower($paginatorName) == \'msearch2\') {
			$tmp = array();
			foreach ($ids as $v) {
				$tmp[$v] = isset($found[$v])
					? $found[$v]
					: 0;
			}
			$paginatorProperties[\'resources\'] = $modx->toJSON($tmp);
			$weight = true;
		}

		if (!empty($_REQUEST[\'sort\'])) {$sort = $_REQUEST[\'sort\'];}
		elseif (!empty($start_sort)) {$sort = $start_sort;}
		else {
			/*
			$sortby = !empty($scriptProperties[\'sortby\']) ? $scriptProperties[\'sortby\'] : \'\';
			if (!empty($sortby)) {
				$sortdir = !empty($scriptProperties[\'sortdir\']) ? $scriptProperties[\'sortdir\'] : \'asc\';
				$sort = $sortby.$mSearch2->config[\'method_delimeter\'].$sortdir;
			}
			*/
		}

		if (!empty($_REQUEST[$paginatorProperties[\'pageVarKey\']])) {
			$page = (int) $_REQUEST[$paginatorProperties[\'pageVarKey\']];
		}
		if (!empty($sort)) {
			$paginatorProperties[\'sortby\'] = $mSearch2->getSortFields($sort);
			$paginatorProperties[\'sortdir\'] = \'\';
		}

		$paginatorProperties[\'start_limit\'] = $start_limit;
		$savedProperties[\'paginatorProperties\'] = $paginatorProperties;

		// We have a delimeters in $_GET, so need to filter resources
		if (strpos(implode(array_keys($_GET)), $mSearch2->config[\'filter_delimeter\']) !== false) {
			$matched = $mSearch2->Filter($ids, $_REQUEST);
			$matched = array_intersect($ids, $matched);
			if ($scriptProperties[\'suggestions\']) {
				$suggestions = $mSearch2->getSuggestions($ids, $_REQUEST, $matched);
				$pdoFetch->addTime(\'Suggestions retrieved.\');
			}
			// Trying to save weight of found ids again
			if ($weight) {
				$tmp = array();
				foreach ($matched as $v) {$tmp[$v] = isset($found[$v]) ? $found[$v] : 0;}
				$paginatorProperties[\'resources\'] = $modx->toJSON($tmp);
			}
			else {
				$paginatorProperties[\'resources\'] = implode(\',\', $matched);
			}
		}
		// Saving log
		$log = $pdoFetch->timings;
		$pdoFetch->timings = array();

		//$paginator->setProperties($paginatorProperties);
		$paginator->setCacheable(false);
		$output[\'results\'] = !empty($paginatorProperties[\'resources\'])
			? $paginator->process($paginatorProperties)
			: $modx->lexicon(\'mse2_err_no_results\');
		$output[\'total\'] = $modx->getPlaceholder($paginatorProperties[\'totalVar\']);
	}
	else {
		$modx->log(modX::LOG_LEVEL_ERROR, \'[mSearch2] Could not find pagination snippet with name: "\'.$paginatorName.\'"\');
		return \'\';
	}
}

// ----------------------  Loading filters
$pdoFetch->timings = $log;
if (!empty($paginator)) {
	$pdoFetch->addTime(\'Fired paginator: "\'.$paginatorName.\'"\');
}
else {
	$pdoFetch->addTime(\'Could not find pagination snippet with name: "\'.$paginatorName.\'"\');
}
if (empty($filters)) {
	$pdoFetch->addTime(\'No filters retrieved\');
	$output[\'filters\'] = $modx->lexicon(\'mse2_err_no_filters\');
	if (empty($output[\'results\'])) {$output[\'results\'] = $modx->lexicon(\'mse2_err_no_results\');}
}
else {
	$pdoFetch->addTime(\'Filters retrieved\');
	$request = array();
	foreach ($_GET as $k => $v) {
		$request[$k] = explode($mSearch2->config[\'values_delimeter\'], $v);
	}

	foreach ($filters as $filter => $data) {
		if (empty($data) || !is_array($data)) {continue;}
		$tplOuter = !empty($scriptProperties[\'tplFilter.outer.\'.$filter]) ? $scriptProperties[\'tplFilter.outer.\'.$filter] : $scriptProperties[\'tplFilter.outer.default\'];
		$tplRow = !empty($scriptProperties[\'tplFilter.row.\'.$filter]) ? $scriptProperties[\'tplFilter.row.\'.$filter] : $scriptProperties[\'tplFilter.row.default\'];
		$tplEmpty = !empty($scriptProperties[\'tplFilter.empty.\'.$filter]) ? $scriptProperties[\'tplFilter.empty.\'.$filter] : \'\';

		// Caching chunk for quick placeholders
		$pdoFetch->getChunk($tplRow);

		$rows = $has_active = \'\';
		list($table,$filter2) = explode($mSearch2->config[\'filter_delimeter\'], $filter);
		$idx = 0;
		foreach ($data as $v) {
			if (empty($v)) {continue;}
			$checked = isset($request[$filter]) && in_array($v[\'value\'], $request[$filter]) && isset($v[\'type\']) && $v[\'type\'] != \'number\';
			if ($scriptProperties[\'suggestions\']) {
				if ($checked) {$num = \'\'; $has_active = \'has_active\';}
				else if (isset($suggestions[$filter][$v[\'value\']])) {
					$num = $suggestions[$filter][$v[\'value\']];
				}
				else {
					$num = !empty($v[\'resources\']) ? count($v[\'resources\']) : \'\';
				}
			} else {$num = \'\';}

			$rows .= $pdoFetch->getChunk($tplRow, array(
				\'filter\' => $filter2
				,\'table\' => $table
				,\'title\' => $v[\'title\']
				,\'value\' => $v[\'value\']
				,\'type\' => $v[\'type\']
				,\'checked\' => $checked ? \'checked\' : \'\'
				,\'selected\' => $checked ? \'selected\' : \'\'
				,\'disabled\' => !$checked && empty($num) && $scriptProperties[\'suggestions\'] ? \'disabled\' : \'\'
				,\'delimeter\' => $mSearch2->config[\'filter_delimeter\']
				,\'idx\' => $idx++
				,\'num\' => $num
			), $fastMode);
		}

		$tpl = empty($rows) ? $tplEmpty : $tplOuter;
		if (!isset($output[\'filters\'][$filter])) {$output[\'filters\'][$filter] = \'\';}
		$output[\'filters\'][$filter] .= $pdoFetch->getChunk($tpl, array(
			\'filter\' => $filter2
			,\'table\' => $table
			,\'rows\' => $rows
			,\'has_active\' => $has_active
			,\'delimeter\' => $mSearch2->config[\'filter_delimeter\']
		), $fastMode);
	}

	if (empty($output[\'filters\'])) {
		$output[\'filters\'] = $modx->lexicon(\'mse2_err_no_filters\');
		if (empty($output[\'results\'])) {$output[\'results\'] = $modx->lexicon(\'mse2_err_no_results\');}
	}
	else {
		$pdoFetch->addTime(\'Filters templated\');
	}
}
$pdoFetch->addTime(\'Total filter operations: \'.$mSearch2->filter_operations);

// Saving params into cache for ajax requests
$savedProperties[\'scriptProperties\'] = $scriptProperties;
$hash = sha1(serialize($savedProperties));
$_SESSION[\'mSearch2\'][$hash] = $savedProperties;

// Active class for sort links
if (!empty($sort)) {$output[$sort] = $classActive;}
if (isset($paginatorProperties[\'tpl_idx\'])) {
	$output[\'tpl\'.$paginatorProperties[\'tpl_idx\']] = $classActive;
	$output[\'tpls\'] = 1;
}

// Setting values for frontend javascript
$config = array(
	\'cssUrl\' => $mSearch2->config[\'cssUrl\'].\'web/\',
	\'jsUrl\' => $mSearch2->config[\'jsUrl\'].\'web/\',
	\'actionUrl\' => $mSearch2->config[\'actionUrl\'],
	\'queryVar\' => $mSearch2->config[\'queryVar\'],
	\'filter_delimeter\' => $mSearch2->config[\'filter_delimeter\'],
	\'method_delimeter\' => $mSearch2->config[\'method_delimeter\'],
	\'values_delimeter\' => $mSearch2->config[\'values_delimeter\'],
	\'start_sort\' => $start_sort,
	\'start_limit\' => $start_limit,
	\'start_page\' => 1,
	\'start_tpl\' => \'\',
	\'sort\' => $sort == $start_sort ? \'\' : $sort,
	\'limit\' => $limit == $start_limit ? \'\' : $limit,
	\'page\' => $page,
	\'tpl\' => !empty($paginatorProperties[\'tpl_idx\'])
			? $paginatorProperties[\'tpl_idx\']
			: \'\',
	\'parentsVar\' => $parentsVar,
	\'key\' => $hash,
	\'pageId\' => !empty($pageId) ? (integer) $pageId : $modx->resource->id,
	$queryVar => isset($_REQUEST[$queryVar]) ? $_REQUEST[$queryVar] : \'\',
	$parentsVar => isset($_REQUEST[$parentsVar]) ? $_REQUEST[$parentsVar] : \'\',
);

$modx->regClientStartupScript(\'
<script type="text/javascript">
mse2Config = \'.$modx->toJSON($config).\';
</script>\', true);
$modx->setPlaceholders($config, $plPrefix);

// Prepare output
$log = \'\';
if ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {
	$log = \'<pre class="mFilterLog">\' . print_r($pdoFetch->getTime(), 1) . \'</pre>\';
}

if (!empty($toSeparatePlaceholders)) {
	$modx->setPlaceholders($output[\'filters\'], $toSeparatePlaceholders);
	$output[\'log\'] = $log;
	if (is_array($output[\'filters\'])) {
		$output[\'filters\'] = implode($outputSeparator, $output[\'filters\']);
	}

	if (empty($output[\'results\'])) {
		$pcre = \'/^\' . preg_quote($toSeparatePlaceholders) .\'(\\d+)$/\';
		foreach ($modx->placeholders as $k => $v) {
			if (preg_match($pcre, $k)) {
				$output[\'results\'][] = $v;
			}
		}
		$output[\'results\'] = implode($outputSeparator, $output[\'results\']);
	}

	$modx->setPlaceholders($output, $toSeparatePlaceholders);
}
else {
	if (is_array($output[\'filters\'])) {
		$output[\'filters\'] = implode($outputSeparator, $output[\'filters\']);
	}
	if (!empty($toPlaceholders)) {
		$output[\'log\'] = $log;
		$modx->setPlaceholders($output, $toPlaceholders);
	}
	else {
		$output = $pdoFetch->getChunk($scriptProperties[\'tplOuter\'], $output, $fastMode);
		$output .= $log;

		return $output;
	}
}',
    ),
  ),
  'd378074b3054441734f33883bccb42ec' => 
  array (
    'criteria' => 
    array (
      'name' => 'mSearch2',
    ),
    'object' => 
    array (
      'id' => 8,
      'source' => 0,
      'property_preprocess' => 0,
      'name' => 'mSearch2',
      'description' => '',
      'editor_type' => 0,
      'category' => 13,
      'cache_type' => 0,
      'plugincode' => '$id = 0;

switch ($modx->event->name) {

	case \'OnDocFormSave\':
	case \'OnResourceDelete\':
	case \'OnResourceUndelete\':
		/* @var modResource $modResource */
		if (!empty($resource) && $resource instanceof modResource) {
			$id = $resource->get(\'id\');
		}
	break;

	case \'OnCommentSave\':
	case \'OnCommentRemove\':
	case \'OnCommentDelete\':
		/* @var TicketComment $TicketComment */
		if (!empty($TicketComment) && $TicketComment instanceof TicketComment) {
			$id = $TicketComment->getOne(\'Thread\')->get(\'resource\');
		}
	break;

}


if (!empty($id)) {
	/* @var modProcessorResponse $response */
	$response = $modx->runProcessor(\'mgr/index/update\', array(\'id\' => $id), array(\'processors_path\' => MODX_CORE_PATH . \'components/msearch2/processors/\'));

	if ($response->isError()) {
		$modx->log(modX::LOG_LEVEL_ERROR, print_r($response->getAllErrors(), true));
	}
}',
      'locked' => 0,
      'properties' => NULL,
      'disabled' => 0,
      'moduleguid' => '',
      'static' => 1,
      'static_file' => 'core/components/msearch2/elements/plugins/plugin.msearch2.php',
      'content' => '$id = 0;

switch ($modx->event->name) {

	case \'OnDocFormSave\':
	case \'OnResourceDelete\':
	case \'OnResourceUndelete\':
		/* @var modResource $modResource */
		if (!empty($resource) && $resource instanceof modResource) {
			$id = $resource->get(\'id\');
		}
	break;

	case \'OnCommentSave\':
	case \'OnCommentRemove\':
	case \'OnCommentDelete\':
		/* @var TicketComment $TicketComment */
		if (!empty($TicketComment) && $TicketComment instanceof TicketComment) {
			$id = $TicketComment->getOne(\'Thread\')->get(\'resource\');
		}
	break;

}


if (!empty($id)) {
	/* @var modProcessorResponse $response */
	$response = $modx->runProcessor(\'mgr/index/update\', array(\'id\' => $id), array(\'processors_path\' => MODX_CORE_PATH . \'components/msearch2/processors/\'));

	if ($response->isError()) {
		$modx->log(modX::LOG_LEVEL_ERROR, print_r($response->getAllErrors(), true));
	}
}',
    ),
  ),
  '0cd9b5469126eaf273a266b744ac4563' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 8,
      'event' => 'OnDocFormSave',
    ),
    'object' => 
    array (
      'pluginid' => 8,
      'event' => 'OnDocFormSave',
      'priority' => 1,
      'propertyset' => 0,
    ),
  ),
  '786c44b3c907f796c99b6e8043c8c75d' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 8,
      'event' => 'OnResourceDelete',
    ),
    'object' => 
    array (
      'pluginid' => 8,
      'event' => 'OnResourceDelete',
      'priority' => 1,
      'propertyset' => 0,
    ),
  ),
  '33b81e0fa0ee82096b2a15ba7748bf14' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 8,
      'event' => 'OnResourceUndelete',
    ),
    'object' => 
    array (
      'pluginid' => 8,
      'event' => 'OnResourceUndelete',
      'priority' => 1,
      'propertyset' => 0,
    ),
  ),
  'e64db8e4e77000b987828905dab8c00a' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 8,
      'event' => 'OnCommentSave',
    ),
    'object' => 
    array (
      'pluginid' => 8,
      'event' => 'OnCommentSave',
      'priority' => 1,
      'propertyset' => 0,
    ),
  ),
  '8c19b951c8ce9bf3efb0827784cbc7b8' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 8,
      'event' => 'OnCommentRemove',
    ),
    'object' => 
    array (
      'pluginid' => 8,
      'event' => 'OnCommentRemove',
      'priority' => 1,
      'propertyset' => 0,
    ),
  ),
  '4f9bdaa8e6d8bfdbaf81a49ae6adfbd7' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 8,
      'event' => 'OnCommentDelete',
    ),
    'object' => 
    array (
      'pluginid' => 8,
      'event' => 'OnCommentDelete',
      'priority' => 1,
      'propertyset' => 0,
    ),
  ),
);